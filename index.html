<!DOCTYPE html>
<html>
<head>
   <title>ai_ledger</title>
</head>
   <body style="display:flex;flex-direction: column;">
     <style>/* PC */
      hr{border:solid 1px cadetblue}
        html, body { height: 100%; width:100%; background:black; margin:0}
        body{padding-top:1em;display:flex;flex-direction:column;overflow:hidden;
         justify-content:space-evenly;align-items:center;}
         .topLeftBtn1{position:absolute;top:3px;left:6px;display:flex;}
         .topLeftBtn1 .txt1{ color:skyblue; font-size:0.444em;margin:3px 0 0 3px;}
         .topLeftBtn1 .icon1 {font-size:1em;padding-bottom:6px;}
         .topRightBtn2{position:absolute;top:3px;right:6px;display:flex;}
         .topRightBtn2 .txt1{ color:skyblue; font-size:0.444em;margin:3px 0 0 3px;}
         .topRightBtn2 .icon1 {font-size:1em;padding-bottom:6px;}
         .docDeleteBtn {border-radius: 100%; background: darkgrey;}
         .docTopicBtn {border-radius: 13px;margin-top: 10px;background: slategrey;
            color: skyblue; font-size: 0.666em; padding: 6px;}
         .docTopicBtn:hover{border:2px solid steelblue}
        .mainBtn{margin:1em; color:darkblue;} 
        .subMenuBtn { color:#75bdb7; border-radius: 13px;  background-image: linear-gradient(grey, steelblue, black);
                   margin:0.666em;cursor:pointer;font-size:0.888em;padding: 2px 6px 4px 6px; }
        .boxTitle{font-size:1.222em}
        .btnTXT{font-size:1em;}
        .addBtn1{border-radius:13px;background:#7bd67b;float: right;
         margin-right: 0%;cursor:pointer;
         font-size: 0.666em;margin-top: 0.888em;
      }
        .genReportBtn1{border-radius:13px;
         background:#6cd8d8;
         /* background:#bd814f; */
         float: right;
         margin-right: 2%;cursor:pointer;
         font-size: 0.666em;margin-top: 0.888em;padding:0.222em;
         padding-left: 0.666em;color:#012d56;padding-right: 0.444em;
    padding-bottom: 0.444em;
      }
      .genBtn1{font-size:0.666em; border-radius:22px; cursor:pointer;
         background:#5fa9a9; border-radius: 10px;color:#060252;
         margin: 1em;
      }
      .saveBtn2{border-radius:13px;background:#d1d67b;
         cursor:pointer; margin:1em 0 1em 0;
         font-size: 0.666em;

      }
      .decBtn1{font-size:0.666em; border-radius:22px; cursor:pointer;
         background:#5fa9a9; border-radius: 10px;color:#060252;
         /* margin: 1em; */
      }
      #saveTickBtn1{border-radius:13px;background:#d1d67b;float: right;
         margin-right: 2%;cursor:pointer;display:none;
         font-size: 0.666em;margin-top: 0.888em;
      }
      #saveSpotBtn1{border-radius:13px;background:#d1d67b;float: right;
         margin-right: 2%;cursor:pointer;display:none;
         font-size: 0.666em;margin-top: 0.888em;
      }
      .delBtn1{    border: solid 1px #9e1717;
    border-radius: 22px;
    background: #38014e;
    font-size: 0.666em;
    cursor:pointer;
    margin: 0.444em;
    /* margin-bottom: 0; */

   }

   .roleBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.444em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .roleData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0;
    text-align: center;
    max-width: 68px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}


   .tkrPriceBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.444em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .tkrPriceData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 34px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}

    .tkrPriceDate1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 40px;
    height: 16px;
    font-size: 0.444em;
    margin-bottom: -1px;
    border: 1px solid steelblue;}

   .spotamountBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.222em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .spotamountData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 34px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}

    .tkrATHBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.444em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .tkrATHData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 34px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}
   .tkrATHDate1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 40px;
    height: 16px;
    font-size: 0.444em;
    margin-bottom: -1px;
    border: 1px solid steelblue;}


   .spotATHBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.222em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .spotATHData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 34px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}
   .spotAtBOX1{border-radius: 8px;
    font-size: 0.666em;
    background: #1a0033;
    color: cyan;
    padding-left: 0.555em;
    margin: 0.222em 1em;
    display: flex;
    max-height: 24px;
    align-items: center;
    text-align: right;
   }
   .spotAtData1{    border-radius: 8px;
    font-size: 0.888em;
    background: #02184b;
    color: cyan;
    padding: 0 0.444em;
    text-align: center;
    max-width: 34px;
    height: 16px;
    margin-bottom: -1px;
    border: 1px solid steelblue;}
   .genTicker1{    border-radius: 10px;
         max-width: 66px;
    text-align: center;
    font-size: 0.666em;
    color: cyan;;
    background: #6679a0;
   }
    .genTicker1::-webkit-input-placeholder {
    color: rgb(68, 52, 106);
 }
 .decodeTick1{  border-radius: 10px;
         max-width: 66px;
    text-align: center;
    font-size: 0.666em;
    color: cyan;;
    background: #6679a0;
        }
    .decodeDate1{
      font-size:0.444em;color: #1a8c8c;background: none;
    border: 0;
    max-width: 6em;
    }
   .decodeRow1{margin: 1%;
   display: flex;
   justify-content: space-around;
   align-items: center;
   flex-wrap: wrap;      
   width: 92%;
   border: solid 1px steelblue;
   padding: 0 0 0 1%;
   padding-left: 2%;
   border-radius: 22px;
   }
   .encodeNUMBOX1{
         font-family: sans-serif;
      font-size: 0.555em;
      margin-left: -2em;
      padding-left: 1em;
      display: flex;
   }
   .encodeSelect1{
      color:cyan;
   }
   .decodeNUMBOX1{
         font-family: sans-serif;
      font-size: 0.555em;
      margin-left: -1em;
      padding-left: 1em;
      display: flex;
   }
   .decodeSelect1{
      color:cyan;
   }
   .genRow1{margin: 1%; width:92%; border:solid 1px steelblue;
   border-radius:18px;padding-left: 3%;padding-top: 0;
   display: flex;
   justify-content: space-around;
   align-items: center;
   flex-wrap: wrap;
   }
        /* .btnTXT:hover{color:navajowhite;} */
        .hoverTXT:hover{color:navajowhite;}
        /* .mainBtn:hover{color:navajowhite} */
        /* .btnTXT:hover{color:navajowhite} */
        .subMenuBtn:hover{border:2px solid steelblue; color:darkslategrey}
        .disabled{ color: darkslategrey; border: 1px solid steelblue; 
            background: transparent !important;}
        .hiddenTab{ display:none !important;}
         #textareaBOX {
            background:darkslateblue;
            background-attachment: local;
            background-image:
               linear-gradient(to right, darkslateblue 20px, transparent 20px),
               linear-gradient(to left, darkslateblue 20px, transparent 20px),
               repeating-linear-gradient(darkslateblue, darkslateblue 40px, #344065 40px, #344065 41px, darkslateblue 41px);
            line-height: 31px;
            padding: 8px 10px;
         }
         #rightBOX,#leftBOX,#keyBOX{margin:2px;border: solid 1px steelblue;width: 100%;font-size: 0.777em;}
        
         #encodeBOX, #decodeBOX, #instructionBOX, #scheduleBOX, #historyBOX, #allMarginsBOX{
            margin:2%;
         }

         #generatedScheduleBOX, #generatedProfitsBOX, #generatedMarginsBOX{
            margin:2%;
         }

.profitRow1, .marginsRow1, .detailRow1 {
   display: flex;
    justify-content: space-between;
    margin-right: 2%;
}
.totalsRow1{
   display: flex;
    justify-content: space-evenly;
    font-size: 1.222em;
    color: limegreen;
}
.profitRow1 aside{
   display: flex;
    align-items: center;
}
.marginsRow1 aside{
   display: flex;
    align-items: center;
}
.detailRow1 aside{
   display: flex;
   font-size :0.777em;
    align-items: center;
    margin-left:2%;
    padding-left:2%;
    color:#595fa5;
    line-height: 1.666em;
}
.proTick1{
   width: 44px; /*align item column*/
}
      .smICON{font-size:0.555em;}
      #instructionText{display:none;margin:4%;}

      #keyINPUT:-webkit-autofill { -webkit-box-shadow: 0 0 0px 1000px #233453 inset;}


      #scrollFrame{width: 88%; }  
      /*  custom scroll bar */
      /* .scrollBar2 {height:97%; overflow-x:hidden; background:#010111; border: 1px steelblue solid; border-radius:13px; padding:0.5em; } */
      .scrollBarV {height:97%; overflow-x:scroll; background:#010111; border: 1px steelblue solid; border-radius:13px;  }
      .scrollBarV::-webkit-scrollbar-track { background-color: #010213;  border-radius: 13px; }
      .scrollBarV::-webkit-scrollbar { width: 0.666em; height: 100%; }
      .scrollBarV::-webkit-scrollbar-thumb { background-color: #04223c; border-radius: 13px;
      background-image: -webkit-linear-gradient(0deg, rgba(255, 255, 255, 0.6) 26%, transparent 26%, transparent 51%, rgba(255, 255, 255, -0.4) 51%, rgba(255, 255, 255, 0.6) 74%, transparent 74%, transparent);
      }


/* checkbox_frame */
.checkboxFrame {
  display: block;
  position: relative;
  padding: 0 4px;
    margin: 13px 6px;
  cursor: pointer;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

/* Hide the browser's default checkbox */
.checkboxFrame input {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

/* Create a custom checkbox */
.checkmark {
border:1px solid lime;
border-radius:13px;
  position: absolute;
  top: 0;
  left: 0;
  height: 10px;
  width: 10px;
  background-color: black;
  box-shadow: 0px 2px 6px 1px #010191;  
}

/* On mouse-over, add a grey background color */
.checkboxFrame:hover input ~ .checkmark {
  background-color: #014601;
}

/* When the checkbox is checked, add a blue background */
.checkboxFrame input:checked ~ .checkmark {
  background-color: steelblue;
}

/* Create the checkmark/indicator (hidden when not checked) */
.checkmark:after {
  content: "";
  position: absolute;
  display: none;
}

/* Show the checkmark when checked */
.checkboxFrame input:checked ~ .checkmark:after {
  display: block;
}

/* Style the checkmark/indicator */
.checkboxFrame .checkmark:after {
   left: 4px;
    top: -1px;
    width: 2px;
    height: 6px;
  border: solid #014601;
  border-width: 0 3px 3px 0;
  -webkit-transform: rotate(45deg);
  -ms-transform: rotate(45deg);
  transform: rotate(45deg);
}



      @media only screen and (max-width: 800px) { /* TABLET */
         body{  background-color: #000f1b;}
         .btnTXT{font-size:0.888em;}
         .mainBtn{margin:0.888em;}
         .subMenuBtn{font-size:0.666em;}
         #rightBOX{margin-right:6%; border:0px} 
         #leftBOX{margin-left:8%; border:0px }
         /* .delBtn1{margin-bottom: 1em;} */
         /* .genRow1{padding:0.444em 2% 0.444em 0} */
         /* .decodeRow1{padding:0.222em 2% 0.222em 2%} */
         .boxTitle{font-size:0.888em}
      }  
      @media only screen and (max-width: 500px) { /* PHONE */
         body{ background-color: #08011e;}
         .btnTXT{font-size:0.888em;}
         .mainBtn{margin:0.666em;}
         .subMenuBtn{font-size:0.666em;}
         #messageBOX{flex-direction: column;}
         /* .delBtn1{margin-bottom: 1em;} */
         #encodeBOX, #decodeBOX, #instructionBOX, #scheduleBOX, #historyBOX, #allMarginsBOX{
            margin:2% 0;
         }  
         #scrollFrame{width: 95%; }       
         /* .genRow1{padding:0.444em 2% 0.444em 2%} */
         /* .decodeRow1{padding:0.222em 1% 0.222em 1%} */
         .boxTitle{font-size:0.777em}
      }

     </style>
     <aside class="topLeftBtn1">
      <span class="icon1" style="border-radius:100%;background:steelblue; 
      border:2px solid grey;">🎪</span><span class="txt1">home</span>
      </aside>
      <aside style="font-size: 0.666em;color: steelblue;margin: -10px 0 4px 0;">
        ai_ledger</aside>
      <aside style="font-size: 0.666em;color: steelblue;margin: -10px 0 4px 0;">
      </aside>
      <aside class="topRightBtn2">
         <span class="txt1">charts</span>
         <span class="icon1" style="border-radius:100%;background:crimson; 
         border:2px solid grey;">🎢</span>
         </aside>      
      <header style="display:flex;justify-content:space-evenly; flex: 0 0 auto;
        background-image: linear-gradient(grey, steelblue, black);
        box-shadow:0 0 14px 0px steelblue;border-radius:13px; margin:0 auto;
        width:93%;">
         <button class="mainBtn" onclick="transcribeTXT()" style="border-radius:8px;
            background:grey; 
            cursor:pointer;box-shadow: inset 0px 0px 10px 0px limegreen;">
            <span style="border-radius:100%;background:limegreen;
              border:1px solid grey;">
            🏰</span><span class="btnTXT hoverTXT">Network</span>
         </button>

         <section id="notConnectedBox" class="mainBtn" style="border-radius:8px;
         background:#61f361;padding: 6px;">
            <span>🔴</span> Not Connected 
        </section>

         <section id="ConnectedBox" class="mainBtn" style="border-radius:8px;
         background:#6283be;padding: 6px;border: 1px solid darkslateblue;
         display:none;"><span style="border-radius:33%;background:skyblue;
              border:1px solid grey;">⚡</span>Connected
        </section>

         <section id="savedBox" class="mainBtn" style="border-radius:20px;
            background:rgb(249, 231, 130);padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">💾 saved.</section>

         <section id="copiedBox" class="mainBtn" style="border-radius:20px;
            background:#fad688;padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">🎭 copied.</section>

         <section id="errorBox" class="mainBtn" style="border-radius:20px;
            background:#091d3e;padding:4px 4px 8px 4px;display:none;
            border: 1px solid rgb(221, 118, 2);color:rgb(221, 118, 2);
            ">⚠️ error...</section>


         <button class= "mainBtn " onclick="stopTXT()" style="border-radius:8px;
            background:grey;box-shadow: inset 0px 0px 10px 0px crimson;
            cursor:pointer;"><span style="border-radius:100%;background:firebrick;
              border:1px solid grey;">
            💡</span><span class="btnTX hoverTXT">Market</span>
         </button>
        </header>
      <header id="messageBOX" style="display:flex;flex: 0 0 auto;
      margin: 0.222em;">
         <section id="leftBOX" style="display:flex; justify-content: center;
         border-radius: 13px;padding: 2px 6px;color: steelblue;align-items: center;
         "><span class="smICON">✴&nbsp;&nbsp;</span> ai probability stock forcast <span class="smICON">&nbsp;✳</span></section>            
         <section id="keyBOX" style="display:flex;border: solid 1px steelblue;
         border-radius: 13px;padding: 2px 6px;color: steelblue;align-items: center;
         margin:2px;">
               API:<input id="keyINPUT"  type="password" placeholder="api_key" 
               style="margin-left: 1em; background:#233453;
               border-radius: 10px 0px 0px 10px;"></input>
               <button style="margin-right: 1em; background:#03cbcb;cursor:pointer;
               border-radius: 0px 10px 10px 0px; font-size:0.666em;padding: 4px;" onclick="setAPIKEY();">SET</button>
         </section>
         <section id="rightBOX" style="display:flex;  justify-content: center;
         border-radius: 13px;padding: 2px 6px;color: steelblue;align-items: center;
         "><span class="smICON">&nbsp;&nbsp;✧&nbsp;</span>generate ledger schedule<span class="smICON">&nbsp;❇</span></section>
      
      </header>         
        <!-- <main id="symbolBOX" style="display:none;">
         <button class="subMenuBtn" onclick="primeFn()">prime🗝</button>
         <button class="subMenuBtn" onclick="omniFn()">omni🗝️</button>
         <button class="subMenuBtn" onclick="alphaFn()">alpha🔑</button>
         <button class="subMenuBtn" onclick="ymdFn()">ymd<span style="font-size: 0.777em;
            padding-left: 2px;">📅</span></button>
         <button class="subMenuBtn" onclick="hrFn()"><span style="font-size: 0.777em;
            ">__</span></button>
        </menu> -->
      <!-- <section id="allchatBOX"  class="hiddenTab" style="width:80.888%;margin: 0 2% 0 2%;
      border-radius: 13px; border: solid 1px steelblue; box-shadow: 1px 1px 11px 0px cyan;
      padding: 4% 0 4% 4%; color: cyan;">
         <header style="font-size: 0.777em;">SAVE CHATS (by title): </header>
         <article id="btnContainer" style="display:flex;flex-direction:column;
               align-items:flex-start;">
         </article>
      </section> -->
<article id="scrollFrame" class="scrollBarV" style="overflow:auto;    display: flex;
flex-direction: column; max-width: 777px;
align-items: center;">


      <section id="encodeBOX"
        style="width:80.888%; flex:1;
        border-radius: 13px; border: solid 1px steelblue; 
        box-shadow: 1px 1px 11px 0px cyan;
        padding:2%; color: cyan; line-height: 2.444em;
        /* display: flex;
    flex-direction: column; */

    "
        >
        <button id="latestBtn1" class="genBtn1" style="display:none;float:right" onclick="getLatestTickerClick()">latest🔄</button>
          
        <span class="boxTitle">🎯 <span style="font-size:0.888em; color:cyan">1</span> Encode Stocks <span style="font-size:0.666em">(metadata) 🔬</span></span>
        <article id="encodeDATA"></article>
        <button id="saveTickBtn1" onclick="saveTickerClick()">save🌟</button>
        <button id="genr8Btn" class="genBtn1" onclick="generateSelected()">⚡gener8🗺️</button>
        <button class="delBtn1" style="float:right;margin-top:0.888em;margin-right:4%;" onclick="deleteSelectedTicker()">🗑️</button>
          <button id="addTickBtn" class="addBtn1" onclick="addTickerClick()">add🎇</button>

          <br>
         </section>
         
         <section id="decodeBOX"
         style="width:80.888%; flex:1;
        background: #0a0014;
        border-radius: 13px; border: solid 1px steelblue; box-shadow: 0px 7px 20px 6px #39029e;
        padding: 2%; color: cyan; line-height: 2.444em;" 
        ">
        
        <span class="boxTitle">🎱 <span style="font-size:0.888em;color:#2a2acf">2</span> Decode Spots <span style="font-size:0.666em">(timedata) 🎲</span></span>
        <aside id="decodeSPOTZ"></aside>
        <button class="delBtn1"  style="float:right;margin-top:0.888em;margin-right:4%;"  onclick="deleteSelectedSpot()">🗑️</button>
        <button id="addSpotBtn" class="addBtn1" onclick="addSpotClick()">add🎆</button>
        <button id="saveSpotBtn1" onclick="saveSpotClick()">save⚓</button>
        <button id="addSellBtn" class="genBtn1" onclick="sellSelectedSpots()">🔒lock sell🧾</button>
        <br>
      </section>

      <section id="allMarginsBOX"
         style="width:80.888%; flex:1;
         background:#071936; 
         border-radius: 13px; border: solid 1px #4ba1a9; box-shadow: 0px 7px 7px 3px #023e16;
         padding: 4% 0 4% 4%; color: #47c270; line-height: 2.444em;" 
         ">
         <button id="generateMarginsBtn" class="genReportBtn1" onclick="generateMarginsClick()">gener8✨</button>
         <span class="boxTitle">🐤 <span style="font-size:0.888em;color:#47c270;">
         </span> Generate Margins <span style="font-size:0.666em">(on spots) 💎</span>
         </span><br>
         <article style="font-size:0.777em;font-family: sans-serif;line-height:2.222em;">
            <hr> 
            Margins:
            <section id="generatedMarginsBOX"></section>
            <hr> 
            <button id="detailsBtn1" class="genReportBtn1" style="display:none;" onclick="setMarginDetailsClick(event)">details🔬</button> 
            <button id="totalsBtn1" class="genReportBtn1" style="display:none;" onclick="setMarginDetailsClick(event)">totals🔭</button> 
                      
      </section>
      <section id="scheduleBOX"
        style="width:80.888%; flex:1;
        background: #1f0a00;
        border-radius: 13px; border: solid 1px #a9a04b; box-shadow: 0px 7px 7px 3px #9b6237;
        padding: 4% 0 4% 4%; color: #b19f50; line-height: 2.444em;" 
        ">
        <button id="generateScheduleBtn" class="genReportBtn1" onclick="generateScheduleClick()">gener8📉</button>
        <span class="boxTitle">🔔 <span style="font-size:0.888em;color:#b19f50;">
        </span> Generate Schedule</span><span style="font-size:0.666em"> (measures) 📈
      </span></span><br>
        <article style="font-size:0.666em;">

           <hr>   
           <section id="generatedScheduleBOX"></section>
           <hr>   
           Schedule & Forcast  Quarterly Reports          
           <hr>   
           Monthly Story, for spot-families.
           <hr>   
           Schedule of responses.
           <hr>   
           Forcasts or triggers.
           <hr>     
           Analytic contraints.
         </article>
      </section>
      <section id="historyBOX"
        style="width:80%;flex:1;
        background: #001206;
        border-radius: 13px; border: solid 1px darkgreen; box-shadow: 0px 7px 20px 0px #029e4a;
        padding: 4% 0 4% 4%; color: cyan; line-height: 2.444em;" 
        ">
        <button id="generateProfitBtn" class="genReportBtn1" onclick="generateProfitLossClick()">gener8🏰</button>
        <span class="boxTitle">🌊 <span style="font-size:0.888em;color:cyan;">
         </span> Generate Profit/Loss/Tax </span><span style="font-size:0.666em">(reports) 🚨
         </span></span><br>
        <article style="font-size:0.666em;">
         <hr>   
  
         Profit & Loss:
         <section id="generatedProfitsBOX"></section>
         <hr>   
         Tax Calculations:
         <hr>     
         Analytics
         <hr>     
         Quarterly Story:
       </article> 
      </section>

      <section id="instructionBOX"
        style="width:80%; flex:1;padding: 1% 2% 1% 2%;
        background: #000815; font-size:0.666em;
        border-radius: 13px; border: solid 1px steelblue; box-shadow: 0px 7px 20px 0px #026767;
        color: #341a7f;
    line-height: 3.222em;
    font-family: verdana;
    font-size: 0.777em;     font-weight: bold;
        ">
        <button id="openBtn1" class="genReportBtn1" onclick="openBtnClick()">show💠</button>        
        <span class="boxTitle">💡 Instructions:</span><br>
      <article id="instructionText">
        
        
        <hr>   
        Generate Worksheet, Generate Schedule, Generate Reports.
        <hr><br><hr>  

        # STEPS

        1. ADD numbers QUARTERLY and MONTHLY as WORKSHEET input.

        2. GENERATE REPORT metadata, 

        3. COMPARE against schedule for QUARTERLY and MONTHLY

        4. Try to see clear distinction between
        
        - buyRED or cutLOSS

        - upsideHEDGE or dumbMONEY

        - sellGREEN or rideBULL, DOWNLIMITLOSS UPLIMITTRIM

        - PRESSUP  PRESSDOWN, TRIMUP, TRIMDOWN.

        <hr><br><hr>
         # ACTS

         buyHOLD, sellSAFE, cutLOSS, buySPOT, sellSPOT

         #GAMBLE snap  robinhood  roblox

         #DIVERSIFY LLY and FIRSTSOLAR. CRYPTO

         <hr><br><hr>
        # PRINCIPLES

        MARKET_STATES are NOT easy to DEFINE, until years later.

        CURRENT/PREDICTED MARKET_STATE changes over TIME month to month.

        CAPTURE EXPECTATION vs REALITY - side by side.

        Daily limit: one spot per day max.

        Quarterly and Monthly Limits. 
        
        - 10SPOT_LIMIT: 1000 per month max, 
        
        - 10, 100 SPOT_LIMIT. Per month.

        This financial tool uses NATURAL LANGUAGE PROCESSING to solve that.

        <hr><br><hr>

        # Technical description (ai)

        Ai encode/decode algorithms, to generate, a schedule, 
        of probabilistic states, with spot nlp, 
        and trades tracking with metadata.

        As scheduled routine, set EXPECTATIONS,
        and REVIEW on a MONTHLY and QUARTERLY basis.
        Specificallly, at times of tax review (quarterly),

        An overall report is generated, where NLP tokens,
        are used to generate visual charts of market_state.

        <hr><br><hr>
        # MONTHLY and QUARTERLY VISUALS of all spots:
        sideways, inGREEN, inRED.

        Ticker input is encoded, with spot input, and a 
        schedule of how it compares to static conditions,
        is generated.

        Static Conditions are like all time high, all time low,
        52 week high, 52 week low, quarterly high, quarterly low.
        Also computed, % off of ATH, and recency of ATH, as 1,2,3 months.
        
        LAST-WEDNESDAY (day before last THURSDAY) put in a GUESS and REAL.

        <hr><br><hr>
        QUARTERLY HiGH/LOWS (QHL) and MHL (monthly high lows.) 
        - monthHIGH, monthLOW, quarterHIGH, quarterLOW, yearHIGH, yearLOW
        <hr>
         This tool is designed to help solve a few common problems 
         in a financial ledger. Over and over, similar patters appear.
         Below are those patterns.
         Along with the strategy to classify each.
         In advance of defining probabalistic state.
         To then trigger articulated response and note keeping.

         <hr><br><hr>
        # Patterns of all possible probability.

         - sold too much, thinking it would go down - but it went way up.
         - sold correctly, before it tanked.
         - bought correctly, before it went way up. didnt buy enough.
         - bought and it tanked. Should've bought less, or not at all.
      
         As SPOT patterns:
         - upside hedge spots: put in more, before a BULL. Climbing Stairs.
         - downside buy spots: put in more, in expected CORRECTION. 
            Try to time the bottom of a Market Downturn.
         - rebalance spots: cut loss and move to better percentage spots.
         - upside sell profit spots: try to time the top.

         Formula:
         The prime determination of successful investment is ROI.
         So % ROI is a key metric, among other statistics.
         The state of each SPOT changes, based on TIME and %ROI
         <hr><br><hr>
         EXAMPLE:
         A spot that is down 10% - 1 week after purchase - still has TIME.
         But a spot down 10% - years after purchase - is very bad.
         <hr><br><hr>
         Another EXAMPLE:
         A stock that had a huge run, is only cash - as booked_profit.
         So trimming strategically is required to get returns.
         Alternatively, a stock that has a huge run, but then returns
         to minimal profit (or loss) - years laters, is out of time.
         And is a dog. At that point the state changes from a stock
         that still has time_to_turnaround, or a dog, that needs to 
         cut_loss and rebalance risk off into better profit_margin spots.
         <hr><br><hr>
         Strength and volume
         check low rsi on buy, And
         check for high selling volume as climax (low buys) sellers tapped out.
         check high rsi on sell, And
         check for high buying volume as climax (low sells) buyers tapped out
         check vix for climax of fear or greed. 
         VIX_INFLOW (greed,hype,fomo) VIX_OUTFLOWS(fear,risk,uncertainty)
         <hr><br><hr>
         Another Example:
         Biggest spots for heighest weighted probabilities.
         Smaller spots for less certain probabilities.
         Calculate TREND LENGTH, days above MA:100,200
         <hr><br><hr>
         Another Example:
         fallback to half of bull run - a year later.
         Need to see end of bull.
         Need to see end of bear.
         <hr><br><hr>
         FUD FOMO CASHOUT or CASHIN
         <hr><br><hr>
         Seasonality:
         buy halloween, sell thanksgiving
         <hr><br><hr>
         Bad comps
         last years numbers skewed.
         <hr><br><hr>
         Topics in news, SELLNEWS or BUYNEWS
         CATALYST EVENT_ON and EVENT_OFF
         have an input for topics in the news such as
         beginning or ending of wars, raising or lowering of interest rates,
         last thursday of the month (bustshort, bustputs).
         Or Earnings - how to opposite_respond - earnings calls?
         <hr><br><hr>
         ANALYTICS:
         - days_sideways
         - days_red
         - days_green
         - %_green
         - %_red
         <hr><br><hr>
         GOAL2GO
         GOAL to make in a YEAR, Goal to make in Quarter, 
         Goal to make in month
         Goal to make in week, goal to make in day.
         <hr><br><hr>
         VISUALIZATIONS:
         Graphs and charts for ticker over time, to show state.
         With Natural Language Processing parameters.
         To trigger various prescribed strategy.
         <hr><br><hr>
         Over TIME durations: 
         - stock goes up mild 10% 20% 
         - stock goes up hot  50%, 100% 500%
         - stock stays flat +- 10% range 
         - stock is cold -10% 20%
         - stock is dog.
         <hr><br><hr>
         FORCAST:
         select box: up middle down - then result.
         And set reactions on results.
         Example: every 20% up sell 10% 
         or 1/3 up, sell 1/4.
         <hr><br><hr>
         ## NLP Classification mechanism

         More animated pattern recognitions.
         hot-bull, mild-bull, mild-bear, hot-bear.
                  
         NLP parameters for the SPOTS, 
         top-out, dip, correction, retracement, head and shoulders.
         upside-hedge, seeking-bottom,
         pruning-top, rebalance-out, rebalance-in.
         % to point. Like % to go under water.
         And total trade-profits, with total-red positions,
         And total-green positions.
         <hr><br><hr>
         Quarterly_Market_Narratives:
         - higher for longer - geo-political risks
         - taboo 10yr over 5% - weakened consumer
         - consumer stimulus pullback
         NEGATIVE_TO_POSITIVE shift
         POSITIVE_TO_NEGATIVE shift
         NEW_NEGATIVE
         NEW_POSITIVE
         UPSIDE_SURPRISE
         DOWNSIDE_SURPRISE
         <hr><br><hr>
         LITMUS_STOCKS. TRENDS_TO_WATCH
         COSTCO and WMT to read CONSUMER_RISK
         GOOGLE and MICROSOFT for TECH GROWTH
         MDB and AMD and NVDIA for AI GROWTH
         QQQ XLK and SPX for Industry_Trends
         STATE_CHANGES: 
         HOOD moves from watch to gamble or
         HOOD moves from watch to cutloss.
         
         <hr><br><hr>
         KEY_POINT_INDICATOR_worksheet:
         10yr 5% interest rates
         200 day moving average bounce to ATH or return
         breach of 100 day, 200day.
         breach of 10% up ytd
         breach of 20% up ytd
         RSI and Market sentiment fear_greed_index
         S&P500 4500
         Russel 200 turnaround
         <hr><br><hr>
         HISTORIC_DATA_MATRIX
         latest_price
         new_ath 
         new_high_quarter, new_low_month
         new_low_quarter, new_low_month
         month_spot, quarter_spot, ytd_spot
         resistance_support_ranges
         
         <hr><br><hr>

         With expectations as,
         Expecting_bull, expecting_bottom.

         Weighted probabilities, change actions on stocks,
         based on path that stocks take, over time.

         Where increasing time, increases weighted probability,
         of correctness of classification.

         Quarterly Story: buzzwords: 'higher for longer', 'quantitative easing'
         etc.
          
         TrimSpot: 1,2,3,4...: 10%, date, margin.
         PressSpots 1,2,3,4...: avg_price, date

         RISK_ON, RISK_OFF.
         NLP: Nomenclature,Taxonomy,Ontology,Index,FoundationModel.
         HeadWind, TailWind.
         <hr><br><hr>
         Forcast Dashboard: 
         what if it breaks out (earning beat) +10%
         - what if it tanks 10%?
         - what if sideways for quarter?
         <hr><br><hr>
         Analytic display.
         Individual Spot Profit/Loss.
         SpotFamily Profit/Loss.

         LAST_DAY, FIRST_DAY.
         - input data on the last day and first day of data every month.
         - put a reminder on phone. along with last thursday.
         - SET NEW upper band and lower band RANGE ALERTS! - every month.
         - 10% and 20% (mid moves and big moves) 

         <hr><br><hr>
         RULES:
         buy the best on red 🔴⚠️
         sell on green,🚀
         detect market waves.🌊

      </article>

      </section>


   </article>

    <!-- <menu style="display:flex;justify-content:space-evenly;background: #182b3d;
        border-radius: 30px;margin:0;padding:0;margin-bottom:-6px;
        box-shadow: inset -5px 7px 8px 0px #472c88;">
        <button class="subMenuBtn" onclick="undoFn()">↶undo</button>
        <button class="subMenuBtn" onclick="titlelineFn()">#️⃣title</button>
        <button class="subMenuBtn" onclick="numberlineFn()">🔢1.2.3.</button>
        <button class="subMenuBtn" onclick="endlineFn()">🔣.,_?!</button>
        <button class="subMenuBtn" onclick="quotelineFn()">*️⃣quote</button>
    </menu> -->
      <footer style="display:flex;justify-content:space-evenly;width:90%;margin:0 auto; 
      margin-bottom:0.666%; flex: 0 0 auto;    margin-top: 0.555em;
      background-image: linear-gradient(grey, steelblue, black);
      box-shadow:0 0 14px 0px steelblue;border-radius:13px;">
       <button class="" onclick="saveChatFn()" style="margin:1em;border-radius:8px;background:grey;
          cursor:pointer;box-shadow: inset -1px -1px 4px 1px gold;">
          <span style="border-radius:100%;background:gold;border:1px solid grey;">
            💾</span> <span class="btnTXT hoverTXT">GENERATE</span>
       </button>
       <button class="" onclick="copyLedgerFn()" style="margin:1em;border-radius:8px;background:grey;
          cursor:pointer;box-shadow: inset -1px -1px 4px 1px orangered;">
          <span style="border-radius:100%;background:orangered;border:1px solid grey;">
            📋</span> <span class="btnTXT hoverTXT">COPY LEDGER</span>
       </button>
       <button class="" onclick="resetAllFn()" style="margin:1em;border-radius:8px;background:grey;
          cursor:pointer;box-shadow: inset -1px -1px 4px 1px rebeccapurple;">
          <span style="border-radius:100%;background:rebeccapurple;border:1px solid grey;">
            🎡</span> <span class="btnTXT hoverTXT">RESTART</span>
       </button>
      </footer>
      <legal style="color:darkslategray;font-size: 0.666em;">copyright 2020-2023 netcinematics llc, all rights reserved.
        this is a personal ledger system, not financial advice. 
        It is not intended for day trading use, but quarterly and monthly review.
      </legal>
      <script>
        const currentDate = new Date();
        const year = currentDate.getFullYear();
        const month = (currentDate.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because months are zero-indexed
        const day = currentDate.getDate().toString().padStart(2, '0');
        let current_ymd = `YMD_${year}_${month}_${day}`;

        let keyBOX = document.getElementById('keyBOX');
      //   let symbolBOX = document.getElementById('symbolBOX');
        let keyINPUT = document.getElementById('keyINPUT');
        let symbolINPUT = document.getElementById('symbolINPUT');
        
        let stateConnectedBox = document.getElementById('ConnectedBox');
        let stateNotConnectedBox = document.getElementById('notConnectedBox');

        let encodeBOX = document.getElementById('encodeBOX');
        let encodeDATA = document.getElementById('encodeDATA');
        let decodeBOX = document.getElementById('decodeBOX');
        let decodeSPOTZ = document.getElementById('decodeSPOTZ');
        let scheduleBOX = document.getElementById('scheduleBOX')

        let saveTickBtn1 = document.getElementById('saveTickBtn1');
        let saveSpotBtn1 = document.getElementById('saveSpotBtn1');

        let generatedScheduleBOX = document.getElementById('generatedScheduleBOX');         
        let generatedProfitsBOX = document.getElementById('generatedProfitsBOX');
        let generatedMarginsBOX = document.getElementById('generatedMarginsBOX');


        let detailsBtn1 = document.getElementById('detailsBtn1');
        let totalsBtn1 = document.getElementById('totalsBtn1');
        let openBtn1 = document.getElementById('openBtn1');

        //FINANCIAL - ANALYTICS - CALCULATIONS
        let target_SYMBOL = 'NVDA';
        let daily_data = null;
        let monthly_data = null;
        let calculate_ATH = 0;
        let calculate_ATL = 0;
        let current_PRICE = 0;

         /************************************************\
          * - AI_LEDGER
          *  - ability to save in localstorage
          * ***********************************************/
         let ai_ledger=null;
         let ai_ticks=[],ai_spots=[];
         let ai_tick={}, ai_spot={};

        let ai_ledger_LOAD_from_LOCALSTORAGE=()=>{ //READ from LOCAL STORAGE
            ai_ledger = (localStorage.ai_ledger)?
               JSON.parse( localStorage.ai_ledger ):null;
            if(!ai_ledger){
               ai_ledger_LOAD_MOCK_DATA();
            }
        }; ai_ledger_LOAD_from_LOCALSTORAGE();

        let ai_ledger_LOAD_MOCK_DATA=()=>{ //READ from OBJ
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"222","ath":"100","price_ymd":"2022_10_30"},{"tick":"COST","price":"444","ath":"100","ath_ymd":"2022_10_11"},{"tick":"MDB","price":"100","ath":"200","ath_ymd":"2022_20_22","price_ymd":"2000_22_20"}],"spots":[{"tick":"NVDA","price":"100","ymd":"2023_9_20"},{"tick":"NVDA","price":"100","ymd":"2022_9_22"},{"tick":"COST","price":"100","ymd":"2022_9_22"},{"tick":"MDB","price":"100","ymd":"2023_10_29"},{"tick":"MDB","price":"111","ymd":"2023_10_29"}]}              
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"411","ath":"100","price_ymd":"2022_10_30"},{"tick":"COST","price":"550","ath":"100","ath_ymd":"2022_10_11","price_ymd":"2023_11_01"},{"tick":"MDB","price":"100","ath":"200","ath_ymd":"2022_20_22","price_ymd":"2000_22_20"},{"tick":"MSFT","price_ymd":"2023_11_01"},{"tick":"GOOG","price":"125","price_ymd":"2023_11_01"},{"tick":"QQQ","price":"350","price_ymd":"2023_11_01"},{"tick":"XLK","price":"160","price_ymd":"2023_11_01"},{"tick":"NDAQ","price":"50","price_ymd":"2023_11_01"},{"tick":"COIN","price":"75","price_ymd":"2023_11_01"},{"tick":"BTC","price":"30,000","price_ymd":"2023_11_01"},{"tick":"ETH","price":"1,700","price_ymd":"2023_11_01"},{"tick":"V","price":"230","price_ymd":"2023_11_01"}],"spots":[{"tick":"NVDA","price":"100","ymd":"2023_9_20","role":"HOLD"},{"tick":"NVDA","price":"100","ymd":"2022_9_22","role":"..."},{"tick":"COST","price":"100","ymd":"2022_9_22","role":"..."},{"tick":"MDB","price":"100","ymd":"2023_10_29","role":"HOLD"},{"tick":"MDB","price":"111","ymd":"2023_10_29","role":"..."},{"tick":"GOOG","price":"200","ymd":"2023_10_29","role":"HOLD"}]}
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"405","ath":"100","price_ymd":"2022_10_30"},{"tick":"COST","price":"551","ath":"100","ath_ymd":"2022_10_11","price_ymd":"2023_11_01"},{"tick":"MDB","price":"100","ath":"200","ath_ymd":"2022_20_22","price_ymd":"2000_22_20"},{"tick":"MSFT","price_ymd":"2023_11_01"},{"tick":"GOOG","price":"125","price_ymd":"2023_11_01"},{"tick":"QQQ","price":"350","price_ymd":"2023_11_01"},{"tick":"XLK","price":"160","price_ymd":"2023_11_01"},{"tick":"NDAQ","price":"50","price_ymd":"2023_11_01"},{"tick":"COIN","price":"75","price_ymd":"2023_11_01"},{"tick":"V","price":"231","price_ymd":"2023_11_01"}],"spots":[{"tick":"NVDA","price":"100","ymd":"2023_9_20","role":"HOLD"},{"tick":"NVDA","price":"100","ymd":"2022_9_22","role":"..."},{"tick":"COST","price":"100","ymd":"2022_9_22","role":"..."},{"tick":"MDB","price":"100","ymd":"2023_10_29","role":"WATCH"},{"tick":"MDB","price":"111","ymd":"2023_10_29","role":"HEDGE"},{"tick":"GOOG","price":"200","ymd":"2023_10_29"}]}
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"405","ath":"100","price_ymd":"2022_10_30"},{"tick":"COST","price":"551","ath":"100","ath_ymd":"2022_10_11","price_ymd":"2023_11_01"},{"tick":"MDB","price":"100","ath":"200","ath_ymd":"2022_20_22","price_ymd":"2000_22_20"},{"tick":"MSFT","price_ymd":"2023_11_01"},{"tick":"GOOG","price":"125","price_ymd":"2023_11_01"},{"tick":"QQQ","price":"350","price_ymd":"2023_11_01"},{"tick":"XLK","price":"160","price_ymd":"2023_11_01"},{"tick":"NDAQ","price":"50","price_ymd":"2023_11_01"},{"tick":"COIN","price":"75","price_ymd":"2023_11_01"},{"tick":"V","price":"231","price_ymd":"2023_11_01"}],
            //    "spots":[{"tick":"NVDA","amount":"100","spot_at":"111","ymd":"2023_9_20","role":"HOLD"},{"tick":"NVDA","amount":"100","spot_at":"222","ymd":"2022_9_22","role":"..."},{"tick":"COST","amount":"100","spot_at":"333","ymd":"2022_9_22","role":"..."},{"tick":"MDB","amount":"100","spot_at":"444","ymd":"2023_10_29","role":"WATCH"},{"tick":"MDB","amount":"111","spot_at":"555","ymd":"2023_10_29","role":"HEDGE"},{"tick":"GOOG","amount":"200","spot_at":"666","ymd":"2023_10_29"}]}
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"432","ath":"100","price_ymd":"2022_10_30"},{"tick":"COST","price":"556","ath":"100","ath_ymd":"2022_10_11","price_ymd":"2022_9_22"},{"tick":"MDB","price":"326","ath":"200","ath_ymd":"2022_20_22","price_ymd":"2022_9_22"},{"tick":"MSFT","price_ymd":"2023_11_01","price":"349"},{"tick":"GOOG","price":"128","price_ymd":"YY_MM_DD"},{"tick":"QQQ","price":"362","price_ymd":"YY_MM_DD"},{"tick":"XLK","price":"170","price_ymd":"YY_MM_DD"},{"tick":"NDAQ","price":"50","price_ymd":"YY_MM_DD"},{"tick":"COIN","price":"80","price_ymd":"YY_MM_DD"},{"tick":"V","price":"243","price_ymd":"YY_MM_DD"}],
            //    "spots":[{"tick":"NVDA","amount":"200","spot_at":"412","ymd":"2023_10_20","role":"HOLD"},{"tick":"NVDA","amount":"300","spot_at":"459","ymd":"2023_10_10","role":"WATCH"},{"tick":"COST","amount":"200","spot_at":"552","ymd":"2023_10_20","role":"..."},{"tick":"MDB","amount":"300","spot_at":"370","ymd":"2023_10_12","role":"WATCH"},{"tick":"MDB","amount":"200","spot_at":"333","ymd":"2023_09_21","role":"HEDGE"},{"tick":"GOOG","amount":"200","spot_at":"666","ymd":"2023_10_29"},{"tick":"FSLR","amount":"0","spot_at":"0","ymd":"2023_11_02","role":"WATCH"}]}
            // ai_ledger = {"ticks":[{"tick":"NVDA","price":"464","ath":"493","ath_ymd":"2023_08_31","price_ymd":"2023_11_09"},{"tick":"MDB","price":"326","ath":"569","ath_ymd":"2021_09_19","price_ymd":"2022_9_22"},{"tick":"MSFT","price":"362","ath":"344","ath_ymd":"2023_07_14","price_ymd":"2023_11_09"},{"tick":"GOOGL","price":"133","ath":"150","ath_ymd":"2021_11_19","price_ymd":"2023_11_09"},{"tick":"QQQ","price":"372","ath":"400","ath_ymd":"2021_11_19","price_ymd":"2023_11_09"},{"tick":"XLK","price":"175","ath":"180","ath_ymd":"2023_07_18","price_ymd":"2023_11_09"},{"tick":"NDAQ","price":"51","ath":"70","ath_ymd":"2021_11_05","price_ymd":"2023_11_08"},{"tick":"COIN","price":"89","ath":"105","ath_ymd":"2023_07_14","price_ymd":"2023_11_08"},{"tick":"V","price":"243","ath":"250","ath_ymd":"2023_09_13","price_ymd":"2023_11_09"},{"tick":"COST","price":"563","ath":"590","ath_ymd":"2022_04_08","price_ymd":"2023_11_09"}],
            //    "spots":[{"tick":"NVDA","amount":"200","spot_at":"412","ymd":"2023_10_20","role":"HOLD"},{"tick":"NVDA","amount":"300","spot_at":"459","ymd":"2023_10_10","role":"WATCH"},{"tick":"COST","amount":"200","spot_at":"552","ymd":"2023_10_20","role":"..."},{"tick":"MDB","amount":"300","spot_at":"370","ymd":"2023_10_12","role":"WATCH"},{"tick":"MDB","amount":"200","spot_at":"333","ymd":"2023_09_21","role":"HEDGE"},{"tick":"FSLR","amount":"0","spot_at":"0","ymd":"2023_11_02","role":"WATCH"},{"tick":"NDAQ","amount":"180","spot_at":"49","ymd":"2023_09_22","role":"TRIM"},{"tick":"V","amount":"200","spot_at":"232","ymd":"2023_10_24","role":"HOLD"},{"tick":"GOOG","amount":"500","spot_at":"130","ymd":"2023_09_29","role":"HOLD"},{"tick":"QQQ","amount":"500","spot_at":"370","ymd":"2023_11_09","role":"TRIM"},{"tick":"XLK","amount":"300","spot_at":"168","ymd":"2023_09_18","role":"HOLD"}]}
            ai_ledger = {"ticks":[{"tick":"NVDA","price":"464","ath":"493","ath_ymd":"2023_08_31","price_ymd":"2023_11_09"},{"tick":"MDB","price":"326","ath":"569","ath_ymd":"2021_09_19","price_ymd":"2022_9_22"},{"tick":"MSFT","price":"362","ath":"344","ath_ymd":"2023_07_14","price_ymd":"2023_11_09"},{"tick":"GOOGL","price":"133","ath":"150","ath_ymd":"2021_11_19","price_ymd":"2023_11_09"},{"tick":"QQQ","price":"372","ath":"400","ath_ymd":"2021_11_19","price_ymd":"2023_11_09"},{"tick":"XLK","price":"175","ath":"180","ath_ymd":"2023_07_18","price_ymd":"2023_11_09"},{"tick":"NDAQ","price":"51","ath":"70","ath_ymd":"2021_11_05","price_ymd":"2023_11_08"},{"tick":"COIN","price":"89","ath":"105","ath_ymd":"2023_07_14","price_ymd":"2023_11_08"},{"tick":"V","price":"243","ath":"250","ath_ymd":"2023_09_13","price_ymd":"2023_11_09"},{"tick":"COST","price":"563","ath":"590","ath_ymd":"2022_04_08","price_ymd":"2023_11_09"},{"tick":"AMD","price":"113","ath":"130","ath_ymd":"2023_06_12","price_ymd":"2023_11_09"}],
               "spots":[{"tick":"NVDA","amount":"200","spot_at":"412","ymd":"2023_10_20","role":"TRIM"},{"tick":"NVDA","amount":"300","spot_at":"459","ymd":"2023_10_10","role":"HOLD"},{"tick":"COST","amount":"200","spot_at":"552","ymd":"2023_10_20","role":"SAFE"},{"tick":"MDB","amount":"300","spot_at":"370","ymd":"2023_10_12","role":"WATCH"},{"tick":"MDB","amount":"200","spot_at":"333","ymd":"2023_09_21","role":"WATCH"},{"tick":"FSLR","amount":"0","spot_at":"0","ymd":"2023_11_02","role":"..."},{"tick":"NDAQ","amount":"180","spot_at":"49","ymd":"2023_09_22","role":"TRIM"},{"tick":"V","amount":"200","spot_at":"232","ymd":"2023_10_24","role":"HOLD"},{"tick":"GOOGL","amount":"500","spot_at":"130","ymd":"2023_09_29","role":"TRIM"},{"tick":"QQQ","amount":"500","spot_at":"370","ymd":"2023_11_09","role":"TRIM"},{"tick":"XLK","amount":"300","spot_at":"168","ymd":"2023_09_18","role":"TRIM"},{"tick":"MSFT","amount":"100","spot_at":"330","ymd":"2023_10_26","role":"HOLD"},{"tick":"MSFT","amount":"100","spot_at":"339","ymd":"2023_10_25","role":"HOLD"},{"tick":"MSFT","amount":"200","spot_at":"316","ymd":"2023_10_02","role":"TRIM"},{"tick":"AMD","amount":"200","spot_at":"102","ymd":"2023_10_02","role":"WATCH"}]}
        }

        let initEncode = ()=>{
            console.log('load ai_ledger');//populate encode table
            let encodeRow,tick1,priceData1,priceDate1,priceBOX1;
            let athData1,athDate1,athBOX1,del1,btn1 = null;
            let encodeNUMBOX1,encodeCHECKBOX1,encodeSelect1;
            let uniqueMAP={};
            encodeDATA.innerHTML=''; //blank out reload.
            for(var i=0; i<ai_ledger.ticks.length;i++){
               if(uniqueMAP[ai_ledger.ticks[i].tick]){continue;}
               encodeRow = document.createElement('article')
               encodeNUMBOX1 = document.createElement('aside')
               encodeNUMBOX1.classList.add('encodeNUMBOX1')
               encodeCHECKBOX1 = document.createElement('label')
               encodeCHECKBOX1.classList.add('checkboxFrame') //encodeNUMBOX1
               encodeNUMBOX1.innerHTML=i+1;            
               encodeSelect1 = document.createElement('input')
               encodeSelect1.type = "checkbox";
               encodeSelect1.classList.add('tkr_checkmark')
               encodeCHECKBOX1.appendChild(encodeSelect1)
               encodeCheckMark1 = document.createElement('span')
               encodeCheckMark1.classList.add('checkmark')
               encodeCHECKBOX1.appendChild(encodeCheckMark1)
               encodeNUMBOX1.appendChild(encodeCHECKBOX1)

               priceBOX1 = document.createElement('aside')
               athBOX1 = document.createElement('aside')
               priceBOX1.innerHTML = "close $&nbsp;"
               athBOX1.innerHTML = "ath&nbsp;"
               tick1 = document.createElement('input')
               priceData1 = document.createElement('input')
               priceDate1 = document.createElement('input')
               athData1 = document.createElement('input')
               athDate1 = document.createElement('input')
               btn1 = document.createElement('button')
               del1 = document.createElement('button')
               del1.innerHTML = '🗑️'
               del1.classList.add('delBtn1')
               del1.setAttribute('data-arg1',i)
               del1.addEventListener('click',(e)=>{
                  deleteTickerClick(e.target.getAttribute('data-arg1'))})
               btn1.innerHTML = 'gener8⚡'
               tick1.value = ai_ledger.ticks[i].tick.toUpperCase();
               tick1.readOnly = false;
               tick1.addEventListener("keyup",(e)=>{
                  saveTickBtn1.style.display = 'block'; });
               athData1.addEventListener("keyup",(e)=>{
                  saveTickBtn1.style.display = 'block'; });
               athDate1.addEventListener("keyup",(e)=>{
                  saveTickBtn1.style.display = 'block'; });
               priceData1.addEventListener("keyup",(e)=>{
                  saveTickBtn1.style.display = 'block'; });
               priceDate1.addEventListener("keyup",(e)=>{
                  saveTickBtn1.style.display = 'block'; });
               priceData1.placeholder = "$0.00";
               priceDate1.placeholder = "yyyy_mm_dd";
               priceData1.value = ai_ledger.ticks[i].price || '';
               priceDate1.value = ai_ledger.ticks[i].price_ymd || '';
               // priceLabel.innerHTML = ai_ledger.ticks[i].price_label || '';
               athData1.placeholder = "$0.00";
               athData1.value = ai_ledger.ticks[i].ath || '';
               athDate1.placeholder = "yyyy_mm_dd";
               athDate1.value = ai_ledger.ticks[i].ath_ymd || '';
               tick1.classList.add('genTicker1')
               priceData1.classList.add('tkrPriceData1')
               priceDate1.classList.add('tkrPriceDate1')
               priceBOX1.classList.add('tkrPriceBOX1')
               athData1.classList.add('tkrATHData1')
               athDate1.classList.add('tkrATHDate1')
               athBOX1.classList.add('tkrATHBOX1')
               btn1.classList.add('genBtn1')
               encodeRow.classList.add('genRow1')
               encodeRow.appendChild(encodeNUMBOX1)
               encodeRow.appendChild(tick1)
               priceBOX1.appendChild(priceData1)
               priceBOX1.appendChild(priceDate1)
               encodeRow.appendChild(priceBOX1)
               athBOX1.appendChild(athData1)
               athBOX1.appendChild(athDate1)
               encodeRow.appendChild(athBOX1)
               // encodeRow.appendChild(btn1)
               // encodeRow.appendChild(del1)
               encodeDATA.appendChild(encodeRow)
               uniqueMAP[ai_ledger.ticks[i].tick] = ai_ledger.ticks[i];
            }
        }; initEncode();

        let initDecode = ()=>{
         let role1,role2,role3,role4,role5,role6,role7,role8,role9;         
         let decodeRow1,date1,tick1,amountData1,amountBOX1,atData1,atBOX1;
         let btn1,roleBOX,roleData,decodeNUMBOX, decodeSelect1,decodeCHECKBOX1;
         decodeSPOTZ.innerHTML=''; //blank out reload.
         for(var i=0; i<ai_ledger.spots.length;i++){
            decodeRow1 = document.createElement('article')
            decodeRow1.classList.add('decodeRow1')
            decodeNUMBOX1 = document.createElement('aside')
            decodeNUMBOX1.classList.add('decodeNUMBOX1')
            decodeCHECKBOX1 = document.createElement('label')
            decodeCHECKBOX1.classList.add('checkboxFrame') //decodeNUMBOX1
            decodeNUMBOX1.innerHTML=i+1;            
            decodeSelect1 = document.createElement('input')
            decodeSelect1.type = "checkbox";
            decodeSelect1.classList.add('spot_checkmark')
            decodeCHECKBOX1.appendChild(decodeSelect1)
            decodeCheckMark1 = document.createElement('span')
            decodeCheckMark1.classList.add('checkmark')
            decodeCHECKBOX1.appendChild(decodeCheckMark1)
            decodeNUMBOX1.appendChild(decodeCHECKBOX1)
            amountBOX1 = document.createElement('aside')
            atBOX1 = document.createElement('aside')
            atBOX1.innerHTML="@&nbsp;"
            roleBOX = document.createElement('aside')
            roleBOX.innerHTML="role&nbsp;"
            roleData = document.createElement('select')
            role1 = document.createElement('option')
            role2 = document.createElement('option')
            role3 = document.createElement('option')
            role4 = document.createElement('option')
            role5 = document.createElement('option')
            role6 = document.createElement('option')
            role7 = document.createElement('option')
            role8 = document.createElement('option')
            role9 = document.createElement('option')
            role1.value = "...";
            role2.value = "HOLD";
            role3.value = "WATCH";
            role4.value = "CUTLOSS";
            role5.value = "HEDGE";
            role6.value = "TRIM";
            role7.value = "SAFE";
            role8.value = "GAMBLE";
            role9.value = "EXIT";
            role1.innerHTML = "...";
            role2.innerHTML = "HOLD";
            role3.innerHTML = "WATCH";
            role4.innerHTML = "CUTLOSS";
            role5.innerHTML = "HEDGE";
            role6.innerHTML = "TRIM";
            role7.innerHTML = "SAFE";
            role8.innerHTML = "GAMBLE";
            role9.innerHTML = "EXIT";
            roleData.appendChild(role1);
            roleData.appendChild(role2);
            roleData.appendChild(role3);
            roleData.appendChild(role4);
            roleData.appendChild(role5);
            roleData.appendChild(role6);
            roleData.appendChild(role7);
            roleData.appendChild(role8);
            roleData.appendChild(role9);
            roleData.value = ai_ledger.spots[i].role || '';
            roleBOX.appendChild(roleData)
            roleBOX.classList.add('roleBOX1')
            roleData.classList.add('roleData1')
         
            date1 = document.createElement('input')
            date1.value = ai_ledger.spots[i].ymd || '';
            date1.classList.add('decodeDate1')
            date1.addEventListener("keyup",(e)=>{
                  saveSpotBtn1.style.display = 'block'; });
            tick1 = document.createElement('input')
            amountData1 = document.createElement('input')
            btn1 = document.createElement('button')
            del1 = document.createElement('button')
            del1.innerHTML = '🗑️'
            del1.classList.add('delBtn1')
            del1.setAttribute('data-arg1',i)
            del1.addEventListener('click',(e)=>{
               deleteSpotClick(e.target.getAttribute('data-arg1'))})            
               btn1.innerHTML = '✨Lock Profit/Loss💥'
               tick1.value = ai_ledger.spots[i].tick || '';
               tick1.readOnly = false;
               amountData1.placeholder = "start:$0.00";
               amountData1.value = ai_ledger.spots[i].amount || '';
            atData1 = document.createElement('input')
            atData1.placeholder = "$0.00";
            atData1.value = ai_ledger.spots[i].spot_at || '';
            tick1.addEventListener("keyup",(e)=>{
                  saveSpotBtn1.style.display = 'block'; });            
            atData1.addEventListener("keyup",(e)=>{
                  saveSpotBtn1.style.display = 'block'; });
            amountData1.addEventListener("keyup",(e)=>{
                  saveSpotBtn1.style.display = 'block'; }); 
            roleData.addEventListener("change",(e)=>{
                  saveSpotBtn1.style.display = 'block'; });
            roleBOX.value = ai_ledger.spots[i].role || '...';
                         
            tick1.classList.add('decodeTick1')
            amountBOX1.classList.add('spotamountBOX1')
            amountData1.classList.add('spotamountData1')
            atData1.classList.add('spotAtData1')
            atBOX1.classList.add('spotAtBOX1')
            btn1.classList.add('decBtn1')
            decodeRow1.appendChild(decodeNUMBOX1)
            decodeRow1.appendChild(date1)
            decodeRow1.appendChild(tick1)
            amountBOX1.innerHTML="$&nbsp;"
            amountBOX1.appendChild(amountData1)
            decodeRow1.appendChild(amountBOX1)
            atBOX1.appendChild(atData1)
            decodeRow1.appendChild(atBOX1)
            decodeRow1.appendChild(roleBOX)
            // decodeRow1.appendChild(btn1)
            // decodeRow1.appendChild(del1)
            decodeSPOTZ.appendChild(decodeRow1)   
                  
         }
        }; initDecode();

        
        let stock_api_key = null;//API_KEY - set in local storage.
        let init_api_key = ()=>{
            //Does local storage have API_KEY?
            // if(!localStorage.stock_api_key){ //if no: display enter key
            //     stateConnectedBox.style.display = "none";
            //     stateNotConnectedBox.style.display = "inline";                   
            //     symbolBOX.style.display = "none";
            //     keyBOX.style.display = "inline";                   
            //     //SHOW NOT CONNECTED. Hide connected. Hide tgt show key input.
            // } else {//if yes init
            //     //SHOW CONNNECTED and tgt, hide disconnected and key input
            //     stateConnectedBox.style.display = "inline";
            //     stateNotConnectedBox.style.display = "none";   
            //     symbolBOX.style.display = "inline";
            //     keyBOX.style.display = "none"; 

            //     stock_api_key = (localStorage.stock_api_key)?localStorage.stock_api_key:'';
            //     //initLedger() 
            // }

    //         if(!stock_api_key){return;}
    //         // const apiKey = '';
    //         const symbol = 'NVDA';
    //         const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${stock_api_key}`;
    //         fetch(apiUrl)
    //         .then(response => response.json())
    //         .then(data => {
    //             // Process the data here (e.g., extract the latest stock price)
    //             const latestPrice = data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]]['1. open'];

    // //             data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]]['1. open'];
    // // '175.3700'
    // // data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]];
    // // {1. open: '175.3700', 2. high: '175.3700', 3. low: '175.0000', 4. close: '175.0000', 5. volume: '24782'}
    //             console.log(`Latest price for ${symbol}: ${latestPrice}`);
    //         })
    //         .catch(error => {
    //             console.error('Error fetching data:', error);
    //         });
        }; //init_api_key();
        let init_monthly = ()=>{
            // replace the "demo" apikey below with your own key from https://www.alphavantage.co/support/#api-key
            // var url = 'https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=IBM&apikey=demo';
            if(!stock_api_key){return;}
            if(localStorage.monthly_NVDA_data){ //LOAD FROM LOCAL not API.
                monthly_data = JSON.parse(localStorage.monthly_NVDA_data);
                // let, val_ath=0,val_atl=0,curr_price=0,perc_off_ath=0;
                let data_keys = Object.keys(monthly_data);
                for(let i=0; i<data_keys.length;i++){
                    daily_data = monthly_data[data_keys[i]];
                    if(parseFloat(daily_data["2. high"]) > calculate_ATH){
                        calculate_ATH = parseFloat(daily_data["2. high"])
                    }
                    if(parseFloat(daily_data["3. low"]) < calculate_ATL || calculate_ATL===0){
                        calculate_ATL = parseFloat(daily_data["3. low"])
                    }
                }
                console.log('ATH:',calculate_ATH)
                console.log('ATL:',calculate_ATL)
                console.log('Curr Price:', current_PRICE)
                console.log('%off ATH', perc_off_ath)
                return;
            }
            // const apiKey = '';
            // const symbol = 'NVDA';
            const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED&symbol=${target_SYMBOL}&apikey=${stock_api_key}`;
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {
                localStorage.monthly_NVDA_data = JSON.stringify(data["Monthly Adjusted Time Series"]);

            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
        }; //init_monthly();

        let setAPIKEY = ()=>{
            if(keyINPUT.value){
                stock_api_key = keyINPUT.value;
               //  localStorage.stock_api_key = stock_api_key
               //  debugger;
               getData_TestConnection();
               //  initLedger()
            }
        }
 
      const addTickerClick = ()=>{ 
         saveTickBtn1.style.display = 'block';
         let encodeRow,tick1,priceData1,priceDate1,athData1,athDate1,athBOX1,saveBtn2;
         encodeRow = document.createElement('article')
         priceBOX1 = document.createElement('aside')
         athBOX1 = document.createElement('aside')
         priceBOX1.innerHTML="now&nbsp;"
         athBOX1.innerHTML="ath&nbsp;"
         tick1 = document.createElement('input')
         priceData1 = document.createElement('input')
         priceDate1 = document.createElement('input')
         athData1 = document.createElement('input')
         athDate1 = document.createElement('input')
         saveBtn2 = document.createElement('button')
         tick1.value = "";
         tick1.readOnly = false;
         tick1.placeholder = "ticker";
         priceData1.placeholder = "$0.00";
         priceDate1.placeholder = "yyyy_mm_dd";
         athData1.placeholder = "$0.00";
         athDate1.placeholder = "yyyy_mm_dd";
         tick1.classList.add('genTicker1')
         tick1.style.margin='1em 0 1em 0';
         priceData1.classList.add('tkrPriceData1')
         priceDate1.classList.add('tkrPriceDate1')
         priceBOX1.classList.add('tkrPriceBOX1')
         priceData1.style.margin='1em 0 1em 0';
         priceDate1.style.margin='1em 0 1em 0';
         athData1.classList.add('tkrATHData1') //todo remove genATH1 and rename
         athDate1.classList.add('tkrATHDate1') //todo remove genATH1 and rename
         athBOX1.classList.add('tkrATHBOX1')
         athData1.style.margin='1em 0 1em 0';
         athDate1.style.margin='1em 0 1em 0';
         saveBtn2.innerHTML = 'save🌟'
         saveBtn2.classList.add('saveBtn2')
         saveBtn2.addEventListener("click",(e)=>{
            saveTickerClick() });
         athData1.addEventListener("keyup",(e)=>{
            saveTickBtn1.style.display = 'block'; });
         athDate1.addEventListener("keyup",(e)=>{
            saveTickBtn1.style.display = 'block'; });
         priceData1.addEventListener("keyup",(e)=>{
            saveTickBtn1.style.display = 'block'; });
         priceDate1.addEventListener("keyup",(e)=>{
            saveTickBtn1.style.display = 'block'; });
         encodeRow.classList.add('genRow1')
         encodeRow.appendChild(tick1)
         priceBOX1.appendChild(priceData1)
         priceBOX1.appendChild(priceDate1)
         encodeRow.appendChild(priceBOX1)
         athBOX1.appendChild(athData1)
         athBOX1.appendChild(athDate1)
         encodeRow.appendChild(athBOX1)
         encodeRow.appendChild(saveBtn2)
         // encodeRow.appendChild(del1)
         encodeDATA.appendChild(encodeRow)         
      }
      const saveTickerClick = ()=>{//loop elements, add data, localstorage
           saveTickBtn1.style.display = 'none';
           let items = encodeDATA.children,row,kids,kid;
           let tkr,price,ath,item=null;
           ai_ledger.ticks = []; //CLEAR LEDGER.
           for(var i=0; i<items.length;i++){ //LOOP DOM ROWS
            item = items[i];
            if(item.classList.contains('genRow1')){ //todo FORM remove btns
               kids = item.children;
               tkr = '';price='',ath='';//blank row.
               for(var j=0; j<kids.length;j++){ //LOOP ROW ITEMS
                  kid = kids[j];
                  if(kid.classList.contains('genTicker1')){
                     kid.value = kid.value.toUpperCase();
                     tkr = kid.value;
                     continue;
                  } if(kid.classList.contains('tkrPriceBOX1')){
                     price = kid.children[0].value;
                     // price_label = kid.innerHTML;
                     price_ymd = kid.children[1].value;
                     continue;
                  } if(kid.classList.contains('tkrATHBOX1')){
                     ath = kid.children[0].value;
                     ath_ymd = kid.children[1].value;
                     continue;                  
                  }
               }
            }
            if(tkr){
               let tickObj = new Object();
               tickObj.tick = tkr;
               if(price){tickObj.price = price}
               // if(price_label){tickObj.price_label = price_label}
               // if(price_label){tickObj.price_label = "now"}
               if(ath){tickObj.ath = ath}
               if(ath_ymd){tickObj.ath_ymd = ath_ymd}
               if(price_ymd){tickObj.price_ymd = price_ymd}
               ai_ledger.ticks.push(tickObj)
            }
           }
           //SAVE to LOCAL STORAGE
           localStorage.ai_ledger = JSON.stringify(ai_ledger)  
           initEncode(); //RELOAD VIEW.         
        }
      const saveSpotClick = ()=>{
           saveSpotBtn1.style.display = 'none';
           let items = decodeSPOTZ.children,row,kids,kid;
           let tkr,amount1,date1,role1,item,spot_at;
           ai_ledger.spots = []; //CLEAR LEDGER.  
           for(var i=0; i<items.length;i++){
            item = items[i];
            if(item.classList.contains('decodeRow1')){
               kids = item.children;
               tkr = '',amount1='',date1='',ath='';//blank row.
               for(var j=0; j<kids.length;j++){
                  kid = kids[j];
                  if(kid.classList.contains('decodeTick1')){
                     kid.value = kid.value.toUpperCase();                     
                     tkr = kid.value;
                  } if(kid.classList.contains('decodeDate1')){
                     date1 = kid.value;
                  } if(kid.classList.contains('spotAtBOX1')){
                     spot_at = kid.lastChild.value;
                  } if(kid.classList.contains('spotamountBOX1')){
                     amount1 = kid.lastChild.value;
                  } if(kid.classList.contains('roleBOX1')){
                     role1 = kid.lastChild.value;
                  } 
               }
            }
            if(tkr){
               let spotObj = new Object();
               spotObj.tick = tkr;
               if(amount1){spotObj.amount = amount1}
               if(spot_at){spotObj.spot_at = spot_at}
               if(date1){spotObj.ymd = date1}
               if(role1){spotObj.role = role1}
               ai_ledger.spots.push(spotObj)
            } else { console.log('unsaved record',i) }
           } 
           //SAVE to LOCAL STORAGE
           localStorage.ai_ledger = JSON.stringify(ai_ledger) 
           initDecode(); //RELOAD VIEW.                      
         }
         const addSpotClick = ()=>{
            saveSpotBtn1.style.display = 'block';
            let decodeRow1,date1,tick1,amountData1;
            let role1,role2,role3,role4,role5,role6,role7,role8,role9;
            let saveBtn3,roleBOX,roleData,atBOX1,atData1;
            decodeRow1 = document.createElement('article')
            decodeRow1.classList.add('decodeRow1')
            atBOX1 = document.createElement('aside')
            atBOX1.innerHTML="@&nbsp;"
            roleBOX = document.createElement('aside')
            roleBOX.innerHTML="role&nbsp;"
            roleData = document.createElement('select')
            role1 = document.createElement('option')
            role2 = document.createElement('option')
            role3 = document.createElement('option')
            role4 = document.createElement('option')
            role5 = document.createElement('option')
            role6 = document.createElement('option')
            role7 = document.createElement('option')
            role8 = document.createElement('option')
            role9 = document.createElement('option')
            role1.value = "...";
            role2.value = "HOLD";
            role3.value = "WATCH";
            role4.value = "CUTLOSS";
            role5.value = "HEDGE";
            role6.value = "TRIM";
            role7.value = "SAFE";
            role8.value = "GAMBLE";
            role9.value = "EXIT";
            role1.innerHTML = "...";
            role2.innerHTML = "HOLD";
            role3.innerHTML = "WATCH";
            role4.innerHTML = "CUTLOSS";
            role5.innerHTML = "HEDGE";
            role6.innerHTML = "TRIM";
            role7.innerHTML = "SAFE";
            role8.innerHTML = "GAMBLE";
            role9.innerHTML = "EXIT";
            roleData.appendChild(role1);
            roleData.appendChild(role2);
            roleData.appendChild(role3);
            roleData.appendChild(role4);
            roleData.appendChild(role5);
            roleData.appendChild(role6);
            roleData.appendChild(role7);
            roleData.appendChild(role8);
            roleData.appendChild(role9);            
            roleBOX.appendChild(roleData)
            roleBOX.classList.add('roleBOX1')
            roleData.classList.add('roleData1')
            atData1 = document.createElement('input')
            atData1.placeholder = "$0.00";
            // atData1.value = ai_ledger.spots[i].spot_at || '';
            saveBtn3 = document.createElement('button')
            date1 = document.createElement('input')
            date1.value = current_ymd.split('YMD_')[1];//user display
            date1.classList.add('decodeDate1')
            tick1 = document.createElement('input')
            amountData1 = document.createElement('input')
            amountBOX1 = document.createElement('aside')
            athBOX1 = document.createElement('aside')
            amountBOX1.innerHTML = "$&nbsp;"
            athBOX1.innerHTML = "ath&nbsp;"
            athData1 = document.createElement('input')
            tick1.value = "";
            tick1.readOnly = false;
            tick1.placeholder="ticker"
            amountData1.placeholder = "0.00";
            athData1.placeholder = "+-:%";
            tick1.addEventListener("keyup",(e)=>{
               saveSpotBtn1.style.display = 'block'; });
            athData1.addEventListener("keyup",(e)=>{
               saveSpotBtn1.style.display = 'block'; });
            amountData1.addEventListener("keyup",(e)=>{
               saveSpotBtn1.style.display = 'block'; });                         
            tick1.classList.add('decodeTick1')
            saveBtn3.innerHTML = 'save🌟'
            saveBtn3.classList.add('saveBtn2')
            saveBtn3.addEventListener("click",(e)=>{
               saveSpotClick() });
            amountData1.classList.add('spotamountData1')
            amountBOX1.classList.add('spotamountBOX1')
            athData1.classList.add('spotATHData1')
            athBOX1.classList.add('spotATHBOX1')
            decodeRow1.appendChild(date1)
            decodeRow1.appendChild(tick1)
            amountBOX1.appendChild(amountData1)
            decodeRow1.appendChild(amountBOX1)
            // athBOX1.appendChild(athData1)
            atData1.classList.add('spotAtData1')
            atBOX1.classList.add('spotAtBOX1')
            atBOX1.appendChild(atData1)            
            decodeRow1.appendChild(atBOX1)
            decodeRow1.appendChild(roleBOX)
            decodeRow1.appendChild(saveBtn3)
            decodeSPOTZ.appendChild(decodeRow1)   
        }
        const deleteTickerClick = (idx)=>{
            if(idx>-1){
               ai_ledger.ticks.splice(idx,1); //remove item
               localStorage.ai_ledger = JSON.stringify(ai_ledger) //SAVE to LOCAL STORAGE
               initEncode(); //RELOAD VIEW.                 
            }
        }
        const deleteSpotClick = (idx)=>{ //remove ledger item, save, refresh
         if(idx>-1){
               ai_ledger.spots.splice(idx,1); //remove item
               localStorage.ai_ledger = JSON.stringify(ai_ledger) //SAVE to LOCAL STORAGE
               initDecode(); //RELOAD VIEW.                 
            }
        }
        const openBtnClick = ()=>{
          if(instructionText.style.display==='block'){
             instructionText.style.display='none'
            } else {
             instructionText.style.display='block'
          }
      }

      const deleteSelectedTicker = ()=>{
         let selected = [],temp=[];
         let items = document.getElementsByClassName('tkr_checkmark');
         for(let i=0; i<items.length;i++){
            if(items[i].checked){
               selected.push(i)
               items[i].checked = false;
            }
         }
         if(!selected.length){showErrorMSG(' Nothing selected 😵') 
            return;}         
         for(let idx=0; idx<ai_ledger.ticks.length;idx++){
            if(!selected.includes(idx)){ //not removed
               temp.push(ai_ledger.ticks[idx])
            } else {console.log('removed',idx)}
            // temp.ticks.splice(selected[idx],1); //remove item
         }
         ai_ledger.ticks = temp;
         localStorage.ai_ledger = JSON.stringify(ai_ledger) //SAVE to LOCAL STORAGE
         initEncode(); //RELOAD VIEW.                 

      }
      const deleteSelectedSpot = ()=>{
         let selected = [], temp = [];
         let items = document.getElementsByClassName('spot_checkmark');
         for(let i=0; i<items.length;i++){
            if(items[i].checked){
               selected.push(i)
               items[i].checked = false;
            }
         }
         if(!selected.length){showErrorMSG(' Nothing selected 😵') 
            return;}         
         for(let idx=0; idx<ai_ledger.spots.length;idx++){
            if(!selected.includes(idx)){ //not removed
               temp.push(ai_ledger.spots[idx])
            } else {console.log('removed',idx)}
         }
         ai_ledger.spots = temp;         
         localStorage.ai_ledger = JSON.stringify(ai_ledger) //SAVE to LOCAL STORAGE
         initDecode(); //RELOAD VIEW.                
      }
        const generateScheduleClick = ()=>{ //GENERATE SCHEDULE DISPLAY
         //TODO if selected, only run selected
         let tickerBOX1,ticker,tickerSet=[];
         let ATH_margin, ATH_pct;
         generatedScheduleBOX.innerHTML = ""
         tickerSet = ai_ledger.ticks;
         for(let i=0;i<tickerSet.length;i++){
            ticker= tickerSet[i];
            tickerBOX1 = document.createElement('aside')
            tickerBOX1.innerHTML = ticker.tick;
            generatedScheduleBOX.appendChild(tickerBOX1)
         }
        }
        const generateProfitLossClick = ()=>{ // GENERATE PROFIT AND LOSS DISPLAY
        }

        let show_margin_details_view = false;
        const setMarginDetailsClick = (e)=>{
            if(e.target.id==='detailsBtn1'){
               detailsBtn1.style.display='none'
               totalsBtn1.style.display='block'
               //hide details btn
               //show totals btn
               show_margin_details_view = true;
            }else{
               //show details btn
               //hide totals btn
               detailsBtn1.style.display='block' //show details btn
               totalsBtn1.style.display='none'               
               show_margin_details_view = false;
            }
            generateMarginsClick();
        }
        const generateMarginsClick = ()=>{ // GENERATE Margin DISPLAY
         //TODO if selected, only run selected
         let ticker,spot_ticker,tickerBOX1,tickerSet=[],spotSet=[],numSPOTS=0;
         let TickMAP_MetaData={},numSPOT1, marginsRow1, profitRow1,curPrice1;
         generatedMarginsBOX.innerHTML = ""; //reset view
         generatedProfitsBOX.innerHTML = ""; //reset view //todo refactor
         detailsBtn1.style.display='block' //show details btn
         tickerSet = ai_ledger.ticks;
         spotSet = ai_ledger.spots;
         //TICKER INIT - iterator METADATA factory (generator)
         for(let i=0;i<tickerSet.length;i++){
            ticker= tickerSet[i];
            if(ticker.tick ){ // INIT META DATA obj
               TickMAP_MetaData[ticker.tick] = {};
               TickMAP_MetaData[ticker.tick].num = 0;
               TickMAP_MetaData[ticker.tick].curr_price = (ticker.price || 0);
               TickMAP_MetaData[ticker.tick].sum_spot_amt = 0;
               TickMAP_MetaData[ticker.tick].total_val = 0;
            }
         }
         //SPOT - iterator - calculate - METADATA generator
         for(let i=0;i<spotSet.length;i++){
            spot_ticker= spotSet[i];
            if(!TickMAP_MetaData[spot_ticker.tick]){ continue }
            TickMAP_MetaData[spot_ticker.tick].num++;
            TickMAP_MetaData[spot_ticker.tick].sum_spot_amt =
               parseInt(TickMAP_MetaData[spot_ticker.tick].sum_spot_amt) + parseInt(spot_ticker.amount || 0);               
            TickMAP_MetaData[spot_ticker.tick].total_val += parseInt(spot_ticker.spot_at || 0);               
         }
         //SPOT - CALCULATE SPOT MARGIN
         let curr_price, total_val,sum_spot_amt, spot_num, spot_margin, margin_pct, avg_price;
         for(let i=0;i<tickerSet.length;i++){
            ticker= tickerSet[i];
            if(!TickMAP_MetaData[ticker.tick]){ continue }
            spot_num = TickMAP_MetaData[ticker.tick].num;
            curr_price = TickMAP_MetaData[ticker.tick].curr_price;
            // spot_price = ticker.spot_at; //TODO rename at_spot
            sum_spot_amt = TickMAP_MetaData[ticker.tick].sum_spot_amt;
            total_val = TickMAP_MetaData[ticker.tick].total_val;
            margin_pct = 0;
            if(curr_price && spot_num && total_val){
               avg_price = total_val / spot_num;
               avg_price = avg_price.toFixed(0);//round number 
               spot_margin = curr_price - avg_price;
               TickMAP_MetaData[ticker.tick].margin = spot_margin || 0;
               TickMAP_MetaData[ticker.tick].avg_price = avg_price || 0;
            }
            if(spot_margin){
               margin_pct = spot_margin / avg_price * 100;
               TickMAP_MetaData[ticker.tick].margin_pct = margin_pct;
            }
            //CALCUALTE SPOT_DAYS: curr_date - spot_date = spot_days
            //CALCUALTE ATH_DAYS: curr_date - ath_date = ath_days
         }

         //TODO separate into displayFactory()
         let avgPrice1,detailRow1;
         //DISPLAY - iterator
         for(let i=0;i<tickerSet.length;i++){
            ticker= tickerSet[i];
            
            if(!TickMAP_MetaData[ticker.tick]){continue;}
            if(!TickMAP_MetaData[ticker.tick].num){continue;}
            marginsRow1 = document.createElement('section')
            marginsRow1.classList.add('marginsRow1')
            profitRow1 = document.createElement('section')
            profitRow1.classList.add('profitRow1')
            tickerBOX1 = document.createElement('aside')
            tickerBOX1.classList.add('proTick1')
            tickerBOX1.innerHTML = ticker.tick;
            numSPOT1 = document.createElement('aside')
            numSPOT1.classList.add('proSpots1')
            curPrice1 = document.createElement('aside')
            curPrice1.classList.add('curPrice1')
            curPrice1.innerHTML =  'last: '+TickMAP_MetaData[ticker.tick].curr_price || 0;
            avgPrice1 = document.createElement('aside')
            avgPrice1.classList.add('avgPrice1')
            avgPrice1.innerHTML =  'avg: '+TickMAP_MetaData[ticker.tick].avg_price || 0;
            numMargin1 = document.createElement('aside')
            numMargin1.classList.add('proMargin1')
            numPCT1 = document.createElement('aside')
            numPCT1.classList.add('proPCT1')
            numTotalAmt1 = document.createElement('aside')
            numTotalAmt1.classList.add('proTotalAmt1')
            numTotalAmt1.innerHTML = 'sum: '+TickMAP_MetaData[ticker.tick].sum_spot_amt || 0;
            numSPOTS = (TickMAP_MetaData[ticker.tick] && TickMAP_MetaData[ticker.tick].num)?
               TickMAP_MetaData[ticker.tick].num:0;
            numSPOT1.innerHTML = 'spots: '+ numSPOTS;
            numMargin1.innerHTML = `margin: 
               ${( TickMAP_MetaData[ticker.tick].margin>0 )?'+':''}
               ${TickMAP_MetaData[ticker.tick].margin}`
            numPCT1.innerHTML = `pct: 
               ${( TickMAP_MetaData[ticker.tick].margin>0 )?'+':''}
               ${TickMAP_MetaData[ticker.tick].margin_pct.toFixed(0)}%`;
 

            marginsRow1.appendChild(tickerBOX1)         
            marginsRow1.appendChild(numSPOT1)         
            marginsRow1.appendChild(numTotalAmt1)         
            marginsRow1.appendChild(avgPrice1)         
            marginsRow1.appendChild(curPrice1)         
            marginsRow1.appendChild(numMargin1)         
            marginsRow1.appendChild(numPCT1)         
            generatedMarginsBOX.appendChild(marginsRow1)         
 
            if(show_margin_details_view){
               //loop over spots of and display detailRow.
               let spotObj,spotDate1,spotAmt1,spotPrice1;
               let spotMargin2=0,spotPCT2=0,curr_price2;
               for(var j=0; j<ai_ledger.spots.length;j++){
                  spotObj = ai_ledger.spots[j];
                  if(spotObj.tick != ticker.tick){continue}
                  detailRow1 = document.createElement('section')
                  detailRow1.classList.add('detailRow1')
                  // detailRow1.innerHTML = ticker.tick;

                  //CALCULATE individual SPOT MARGIN
                  curr_price2 = TickMAP_MetaData[ticker.tick].curr_price;
                  spotMargin2 = curr_price2 - spotObj.spot_at
                  spotPCT2 = (spotMargin2/spotObj.spot_at) * 100 
                  spotPCT2 = spotPCT2.toFixed(0);


                  spotDate1 = document.createElement('aside')
                  spotDate1.classList.add('spotDate1')
                  spotDate1.innerHTML = spotObj.ymd || 0;

                  spotAmt1 = document.createElement('aside')
                  spotAmt1.classList.add('spotAmt1')
                  spotAmt1.innerHTML =  'amt '+spotObj.amount || 0;

                  spotPrice1 = document.createElement('aside')
                  spotPrice1.classList.add('spotPrice1')
                  spotPrice1.innerHTML =  'price '+spotObj.spot_at || 0;

                  spotMargin1 = document.createElement('aside')
                  spotMargin1.classList.add('spotMargin1')
                  spotMargin1.innerHTML =  'margin '+spotMargin2 || 0;

                  spotPCT1 = document.createElement('aside')
                  spotPCT1.classList.add('spotPCT1')
                  spotPCT1.innerHTML =  'pct '+ spotPCT2 || 0;


                  detailRow1.appendChild(spotDate1)         
                  detailRow1.appendChild(spotAmt1)         
                  detailRow1.appendChild(spotPrice1)         
                  detailRow1.appendChild(spotMargin1)         
                  detailRow1.appendChild(spotPCT1)


                  generatedMarginsBOX.appendChild(detailRow1)   


               }
            }
         }
         //PROFIT and LOSS View
         let keyz = Object.keys(TickMAP_MetaData);
         let bookValue = 0, bankValue=0,itm;
         let totMargin=0,totMarginPct,totMarginSum,totMarginBOX,totMarginPctBOX;
         for(let idx=0; idx<keyz.length;idx++){
            itm=TickMAP_MetaData[keyz[idx]];
            bookValue += itm.total_val;
            bankValue += 3;

            if(itm.margin){
               totMargin += itm.margin;
            }
            totMarginSum += itm.margin_pct;
         }
         totMarginPct = totMarginSum/keyz.length;
         let totalsRow1,totBookValue1,totBankValue1;
         totBookValue1 = document.createElement('aside')
         totBookValue1.classList.add('totBookValue1')
         totBookValue1.innerHTML = 'book_value: '+bookValue;
         totMarginBOX = document.createElement('aside')
         totMarginBOX.classList.add('totMarginBOX')
         totMarginBOX.innerHTML = 'total margin: '+totMargin;
         totMarginPctBOX = document.createElement('aside')
         totMarginPctBOX.classList.add('totMarginPctBOX')
         totMarginPctBOX.innerHTML = 'total pct: '+totMarginPct;
         totBankValue1 = document.createElement('aside')
         totBankValue1.classList.add('totBankValue1')
         totBankValue1.innerHTML = 'bank_value: '+bankValue;//+TickMAP_MetaData[ticker.tick].sum_spot_amt || 0;                        
         totalsRow1 = document.createElement('footer')
         totalsRow1.innerHTML = "Totals:"         
         totalsRow1.classList.add('totalsRow1') 
         totalsRow1.appendChild(totBookValue1)         
         totalsRow1.appendChild(totMarginBOX)         
         totalsRow1.appendChild(totBankValue1)         
         generatedProfitsBOX.appendChild(totalsRow1)  
        }
        const generateSelected = ()=>{
         let selected = [];
         let items = document.getElementsByClassName('tkr_checkmark');
         for(let i=0; i<items.length;i++){
            if(items[i].checked){
               selected.push(i)
               items[i].checked = false;
            }
         }
         if(!selected.length){showErrorMSG(' Nothing selected 😵') 
            return;}
         ai_schedule = [];
         ai_analytics = [];
         for(let i=0; i<selected.length;i++){
            //calculate +-%, days since ath, 
         }
         scheduleBOX.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
        })

      }
      const sellSelectedSpots = ()=>{
         let selected = [];
         let items = document.getElementsByClassName('spot_checkmark');
         for(let i=0; i<items.length;i++){
            if(items[i].checked){
               selected.push(i)
               items[i].checked = false;
            }
         }         
         if(!selected.length){showErrorMSG(' Nothing selected 😵') 
            return;}  
      }

      const getLatestTickerClick = ()=>{ //loop all for last close.
         let item,urls=[];
         for(let i=0;i<ai_ledger.ticks.length;i++){
            // if(i>=1){continue;}//DEV_limiter stay below 20
            item = ai_ledger.ticks[i];
            // item.tick = 'NVDA';//DEV_specifier 
            urls.push(`https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${item.tick}&interval=5min&apikey=${stock_api_key}`)
         }
         getData_Quotes(urls)
         showErrorMSG('🌼DATA UPDATED🌼') //todo error. need show message not error.

      }

      /**************************************************************\
       * MSGS : interface
       * \***********************************************************/
       let stateErrorBox = document.getElementById('errorBox');
         let stateSavedBox = document.getElementById('savedBox');
         let stateCopiedBox = document.getElementById('copiedBox');
 

      /**************************************************************\
       * API : interface
       * \***********************************************************/
      const getData_Quotes = async (quotes)=>{
         if(!stock_api_key){ showErrorMSG('🛠️ connect api'); return;}
         if(!quotes.length){return;}
         try{
            for(let i=0; i<quotes.length;i++){
               fetch(quotes[i]).then((data)=>{
                  if(data.ok){
                     return data.json();
                  }
               }).then((tickData)=>{
                  let responseTick = tickData["Meta Data"]["2. Symbol"];
                  if(!responseTick){return;}
                  let latestClose = tickData["Time Series (5min)"][Object.keys(tickData["Time Series (5min)"])[0]]["4. close"];
                  if(!latestClose){return;}
                  console.log(responseTick,"last close",latestClose)
                  updateLatestTickPrice(responseTick,latestClose);
                  //SHOW CONNNECTED and tgt, hide disconnected and key input
                  stateConnectedBox.style.display = "inline";
                  stateNotConnectedBox.style.display = "none";   
                  keyBOX.style.display = "none"; 
                  latestBtn1.style.display = "none"; //do not call twice. because of limit

                  localStorage.ai_ledger = JSON.stringify(ai_ledger) //SAVE to LOCAL STORAGE
                  initEncode(); //RELOAD VIEW. 

               }).catch((error)=>{
                  showErrorMSG('🛠️ api daily limit')
                  console.log(error)
               })
            }
         } catch(error) {
               showErrorMSG('🛠️ api down')
         }           
      }
      const getData_TestConnection = ()=>{
         if(!stock_api_key){
            showErrorMSG('🛠️ connect api')
            return;}
            // const symbol = 'NVDA';
            // const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${stock_api_key}`;
            // fetch(apiUrl)
            // .then(response => response.json())
            // .then(data => {
                //SHOW CONNNECTED and tgt, hide disconnected and key input
                stateConnectedBox.style.display = "inline";
                stateNotConnectedBox.style.display = "none";   
               //  symbolBOX.style.display = "inline";
                keyBOX.style.display = "none"; 
               //  console.log(`Latest price for ${symbol}: ${latestPrice}`);
                latestBtn1.style.display = "inline";
            // })
            // .catch(error => {
            //    showErrorMSG('🛠️ connect api')
            //     console.error('Error fetching data:', error);
            // });                  
      }

      const getData_Intraday = ()=>{
         debugger;
         if(!stock_api_key){return;}
            const symbol = 'NVDA';
            const apiUrl = `https://www.alphavantage.co/query?function=TIME_SERIES_INTRADAY&symbol=${symbol}&interval=5min&apikey=${stock_api_key}`;
            fetch(apiUrl)
            .then(response => response.json())
            .then(data => {

                //SHOW CONNNECTED and tgt, hide disconnected and key input
                stateConnectedBox.style.display = "inline";
                stateNotConnectedBox.style.display = "none";   
                symbolBOX.style.display = "inline";
                keyBOX.style.display = "none"; 

                // Process the data here (e.g., extract the latest stock price)
                const latestPrice = data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]]['1. open'];

    //             data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]]['1. open'];
    // '175.3700'
    // data['Time Series (5min)'][Object.keys(data['Time Series (5min)'])[0]];
    // {1. open: '175.3700', 2. high: '175.3700', 3. low: '175.0000', 4. close: '175.0000', 5. volume: '24782'}
                console.log(`Latest price for ${symbol}: ${latestPrice}`);
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });         
      }

      // let ai_history_matrix = {'NVDA':{ymd_price:{'2023_11_01':'428'}}}


      function updateLatestTickPrice(responseTick,latestClose){
         //loop ai_ledger, update price and latest label.
         let tickr='',item=null;
         for(let i=0; i<ai_ledger.ticks.length;i++){
            tickr=ai_ledger.ticks[i];
            if(tickr.tick===responseTick){ //FOUND ticker record
               ai_ledger.ticks[i].price = latestClose.split('.')[0];
               ai_ledger.ticks[i].price_ymd = formatYMD();
               update_History_matrix(
                  {tick:tickr.tick,
                     ymd:ai_ledger.ticks[i].price_ymd,
                     price: ai_ledger.ticks[i].price
                  })
               break;
            }
         }
      }

      /************************************************\
       * - AI_HISTORY_MATRIX
       *  - ability to save in localstorage
       * ***********************************************/
         let ai_history_matrix=null;

      let ai_history_LOAD_MOCK_DATA=()=>{ //READ from OBJ
         ai_history_matrix = {'NVDA':{ymd_price:{'2023_11_01':'428'}}}
      }

      let ai_history_init=()=>{ //READ from LOCAL STORAGE
         ai_history_matrix = (localStorage.ai_history_matrix)?
            JSON.parse( localStorage.ai_history_matrix ):null;
         if(!ai_history_matrix){
            ai_history_LOAD_MOCK_DATA();
         }
      }; ai_history_init();

      /*************************************\
       * HISTORY_MATRIX - store values in time
      \*************************************/
      let update_History_matrix = ( tickr ) => {//data updated: to not lose, push duplicate to history
         if(!tickr || !tickr.price || !tickr.ymd){return}
         if(!ai_history_matrix[tickr.tick]) { ai_history_matrix[tickr.tick]= {tick:ai_history_matrix[tickr.tick]} }
         if(!ai_history_matrix[tickr.tick]['ymd_price']) { ai_history_matrix[tickr.tick]['ymd_price'] = {} }
         ai_history_matrix[tickr.tick]['ymd_price'][tickr.ymd] = tickr.price;
         //UPDATE LOCALSTORAGE with ai_history_matrix. SAVE
         localStorage.ai_history_matrix = JSON.stringify(ai_history_matrix)  
      }
      /*************************************\
       * UTILITIES
      \*************************************/
         let formatYMD = () => {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Month is zero-based, so add 1 and pad with '0'
            const day = String(currentDate.getDate()).padStart(2, '0');
            const formattedDate = `${year}_${month}_${day}`;
            return formattedDate;
         }
         let primeFn = () => {
            selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
            if(selectedTXT){
               function formatPrimeKey() {// Replace spaces with underscores
                  let addEndSpace = false;
                  if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
                  transcript = selectedTXT.replace(/[ ]/g, '_');
                  transcript = transcript.replace(/[^a-zA-Z_]+/g, '');
                  transcript = `_${transcript}_`; //Wrap in _
                  transcript = transcript.replace(/__/g, '_');
                  transcript = (addEndSpace)?transcript+' ':transcript;
               }; formatPrimeKey();
               textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
                  transcript +
                  textareaBOX.value.substring(textareaBOX.selectionEnd);
               textareaBOX.focus();
            }else{ showErrorMSG('⚠️ double click select...') }
         }
         let omniFn = () => { 
            selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
            if(selectedTXT && selectedTXT.indexOf(' ')>-1){
               let addEndSpace = false;
               if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
               transcript = selectedTXT.replace(/ /g,'_')
               transcript = transcript.replace(/[,.!?<>;:|'"-]/g, '');
               transcript = (addEndSpace)?transcript+' ':transcript;
               textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
                  transcript +
                  textareaBOX.value.substring(textareaBOX.selectionEnd);
               textareaBOX.focus();
            }else{ showErrorMSG('⚠️ select text with spaces...') }
          }
         let alphaFn = () => { 
            selectedTXT = textareaBOX.value.substring(textareaBOX.selectionStart, textareaBOX.selectionEnd);
            if(selectedTXT){
               function formatAlphaKey() {// Replace spaces with underscores
                  let addEndSpace = false;
                  if(selectedTXT.charAt(selectedTXT.length-1)===' '){addEndSpace=true;}
                  transcript = selectedTXT.replace(/[ ]/g, '').toUpperCase();
                  transcript = transcript.replace(/[^a-zA-Z_]+/g, '');
                  transcript = `a${transcript}a`; //Wrap in _
                  transcript = transcript.replace(/aa/g, 'a');
                  transcript = (addEndSpace)?transcript+' ':transcript;
               }; formatAlphaKey();
               textareaBOX.value = textareaBOX.value.substring(0, textareaBOX.selectionStart) +
                  transcript +
                  textareaBOX.value.substring(textareaBOX.selectionEnd);
               textareaBOX.focus();
            }else{ showErrorMSG('⚠️ select any word...') }
          }
         let ymdFn = () => { 
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')             
            if(textareaTXT && textareaTXT.length>0){
               textareaTXT.push(current_ymd);
               textareaBOX.value = textareaTXT.join('\n');
            }            
          }
          let hrFn = () => {
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')             
            if(textareaTXT && textareaTXT.length>0){
               textareaTXT.push('<hr></hr>');
               textareaBOX.value = textareaTXT.join('\n');
            }             
         }             
         let undoFn = () => { 
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')             
            if(textareaTXT && textareaTXT.length>0){
               textareaTXT = textareaTXT.slice(0,textareaTXT.length-1)
               textareaBOX.value = textareaTXT.join('\n');
            }
         };         
         let titlelineFn = () => {  
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')
            if(textareaTXT && textareaTXT.length>0){
                txtline = textareaTXT[textareaTXT.length-1]
                if(txtline.charAt(0)==='#'){
                    if(txtline.charAt(1)==='#'){
                        if(txtline.charAt(2)==='#'){// back to blank
                            txtline = txtline.split(' ')
                            txtline = txtline.splice(1,txtline.length).join(' ')
                        }else{ //add 3
                            txtline = '#'+txtline;
                        }
                    }else{ //add 2
                        txtline = '#'+txtline;
                    }
                }else{ //add 1
                    txtline = '# '+txtline;
                }
                textareaTXT[textareaTXT.length-1] = txtline;
                textareaBOX.value = textareaTXT.join('\n');
                toggleRecordState(false);
               //  recognition.stop();
            }
         };          
         let numberlineFn = () => {  
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')
            if(textareaTXT && textareaTXT.length>0){
                txtline = textareaTXT[textareaTXT.length-1]
                function incrementNum(inputString) { //regex iteration of number lists
                    return inputString.replace(/^(\d+\.)?(.*)$/, function(match, number, rest) {
                        if (number === undefined) { // If no number, add "1." at the beginning
                            return "1. " + rest;
                        } else {// If number, increment and add back to string
                            return (parseInt(number, 10) + 1) + "." + rest;
                        }
                    });
                }; 
                txtline = incrementNum(txtline);
                textareaTXT[textareaTXT.length-1] = txtline;
                textareaBOX.value = textareaTXT.join('\n');
                toggleRecordState(false);
               //  recognition.stop();
            }
         }
      
         let quotelineFn = () => { 
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')
            if(textareaTXT && textareaTXT.length>0){
               if(textareaTXT[textareaTXT.length-1].indexOf('> ')===0){
                  txtline = textareaTXT[textareaTXT.length-1].replace('> ','')
               } else {
                  txtline = '> '+textareaTXT[textareaTXT.length-1]
               }
                textareaTXT[textareaTXT.length-1] = txtline;
                textareaBOX.value = textareaTXT.join('\n');
                toggleRecordState(false);
               //  recognition.stop();
            }            
         }
         let endlineFn = () => {  
            transcript = textareaBOX.value;
            textareaTXT = transcript.split('\n')
            if(textareaTXT && textareaTXT.length>0){
                txtline = textareaTXT[textareaTXT.length-1]
                txttgt = txtline.charAt(txtline.length-1)
                if(txttgt==='.'){ txtline=setCharAt(txtline,txtline.length-1,',');
                } else if(txttgt===','){ txtline=setCharAt(txtline,txtline.length-1,'_');
                } else if(txttgt==='_'){ txtline=setCharAt(txtline,txtline.length-1,'?');
                } else if(txttgt==='?'){ txtline=setCharAt(txtline,txtline.length-1,'!');
                } else if(txttgt==='!'){ txtline=setCharAt(txtline,txtline.length-1,'.');
                } else { txtline += '.';}
                textareaTXT[textareaTXT.length-1] = txtline;
                textareaBOX.value = textareaTXT.join('\n');
                toggleRecordState(false);
               //  recognition.stop();
            }
         };   
         let saveChatFn = () => { //
            // let updated_doc = false;
            // txttgt = getCurrentDocTitle();
            // all_chat_docs = (localStorage.all_chat_docs)?
            //    JSON.parse( localStorage.all_chat_docs ):[];
            // chat_doc = new Object();
            // chat_doc.title = txttgt;
            // chat_doc.txt = textareaBOX.value;               
            // for(let i = 0; i<all_chat_docs.length;i++){
            //    if(all_chat_docs[i].title===txttgt){ //replace
            //       all_chat_docs[i] = chat_doc
            //       updated_doc = true;
            //       break;
            //    }
            // }
            // if(!updated_doc){
            //    all_chat_docs.push(chat_doc)
            // } //SAVE TO LOCAL STORAGE
            // localStorage.all_chat_docs = JSON.stringify(all_chat_docs)
            // //saved msg
            // stateSavedBox.style.display = "inline";
            // stateConnectedBox.style.display = "none";
            // stateNotConnectedBox.style.display = "none";              
            // setTimeout( ()=>{
            //    stateSavedBox.style.display = "none";
            //    stateConnectedBox.style.display = "none";
            //    stateNotConnectedBox.style.display = "inline";  
            //    selectedTXT = '';
            // },3000)                        
         };   
         let copyLedgerFn = () => { 
            console.log(ai_ledger)
            navigator.clipboard.writeText(JSON.stringify(ai_ledger) );
            //copied msg
            //saved msg
            stateCopiedBox.style.display = "inline";
            stateConnectedBox.style.display = "none";
            stateNotConnectedBox.style.display = "none";              
            setTimeout( ()=>{
               stateCopiedBox.style.display = "none";
               if(stock_api_key){
                  stateConnectedBox.style.display = "inline";
                  stateNotConnectedBox.style.display = "none";  
               }else{
                  stateConnectedBox.style.display = "none";
                  stateNotConnectedBox.style.display = "inline";  
               }               
            },2000)               
         };          
         let resetAllFn = () => { 
            ai_ledger_LOAD_MOCK_DATA();
           //SAVE to LOCAL STORAGE
           localStorage.ai_ledger = JSON.stringify(ai_ledger)  
           initEncode(); //RELOAD VIEW.             
           initDecode(); //RELOAD VIEW.             
         };   
//-END-BTN-HANDLERS-------------------------------------------------
//-HELPER_fns-------------------------------------------------------
         let getCurrentDocTitle = () => {
            // transcript = textareaBOX.value;
            // textareaTXT = transcript.split('\n')
            // if(textareaTXT && textareaTXT.length>0){            
            //    return textareaTXT[0];
            // }
            // return ''
         }
         let docLoad = () => { //reload all doc view
            //load data for view from local storage
            // all_chat_docs = (localStorage.all_chat_docs)?JSON.parse( localStorage.all_chat_docs ):[];
            // const btnContainer = document.getElementById('btnContainer');
            // btnContainer.innerHTML='';
            // // Map over the array and create buttons
            // all_chat_docs.forEach(item => {
            //    const section1 = document.createElement('section');
            //    section1.classList.add('docRowBox')
            //    const button1 = document.createElement('button');
            //    button1.textContent = item.title;
            //    button1.classList.add('docTopicBtn')
            //    button1.onclick = function() { docLookup(item.title); };
            //    section1.appendChild(button1);
            //    const button2 = document.createElement('button');
            //    button2.textContent = '🗑️';
            //    button2.classList.add('docDeleteBtn')
            //    button2.onclick = function() { docDelete(item.title); };
            //    section1.appendChild(button2);                  
            //    btnContainer.appendChild(section1);                  
            // });            
         }
         let docLookup = (text) => { //load txt, and switch to view
            // transcript = '';
            // all_chat_docs = (localStorage.all_chat_docs)?
            //    JSON.parse( localStorage.all_chat_docs ):[];
            // for(var i=0; i<all_chat_docs.length;i++){
            //    if(all_chat_docs[i].title===text){
            //       transcript = all_chat_docs[i].txt;
            //       break;
            //    }
            // }
            // textareaBOX.value = transcript;
            // textareaTXT = transcript.split('\n')
            // allchatBOX.classList.add('hiddenTab')
            // textareaBOX.classList.remove('hiddenTab') 
         } 
         let docDelete = (text) => { //lookup, remove from local storage.
            // all_chat_docs = (localStorage.all_chat_docs)?
            //    JSON.parse( localStorage.all_chat_docs ):[];
            // for(var i=0; i<all_chat_docs.length;i++){
            //    if(all_chat_docs[i].title===text){ //-----FOUND DOC
            //       // transcript = all_chat_docs[i].txt;
            //       all_chat_docs.splice(i,1)
            //       localStorage.all_chat_docs = JSON.stringify(all_chat_docs)
            //       docLoad();
            //       break; //splice object out
            //    }
            // }
            // allchatBOX.classList.add('hiddenTab')
            // textareaBOX.classList.remove('hiddenTab') 
         } 
      //    function setCharAt(str,idx,chr) {
      //       if(idx > str.length-1) return str;
      //       return str.substring(0,idx) + chr + str.substring(idx+1);
      //   }        
      //    let keyupTXT = (e) => {
      //       transcript = textareaBOX.value;
      //       textareaTXT = transcript.split('\n')
      //    }
         let showErrorMSG = (err) => {
            console.log(err)
            stateErrorBox.innerHTML = err;
            stateErrorBox.style.display = "inline";
            stateConnectedBox.style.display = "none";
            stateNotConnectedBox.style.display = "none";              
            setTimeout( ()=>{
               stateErrorBox.style.display = "none";
               if( stock_api_key   ){
                  stateConnectedBox.style.display = "inline";
                  stateNotConnectedBox.style.display = "none";  
               } else {
                  stateConnectedBox.style.display = "none";
                  stateNotConnectedBox.style.display = "inline";  
               }
               // selectedTXT = '';
            },3000)
         }
         // textareaBOX.addEventListener("select", (e) => {
         //    selectedTXT = e.target.value.substring(
         //       event.target.selectionStart,
         //       event.target.selectionEnd,
         //    );
         // });
      //    recognition.addEventListener("error", (event) => {
      //       console.error(`TRY CHROME browser: ${event.error}`);
      //       // textareaTXT.push("Try CHROME browser. ~ : )")
      //       // textareaBOX.innerHTML = textareaTXT.join('\n');
      //       // toggleRecordState(false);
      //   });          
      </script> 
   </body>
</html>
